import{o as R,y as K,t as V,z as k,f as g,a as N,q as v,A as P,g as T,B as z,C as A,s as O,_ as C,r as _,E as $,h as b,i as w,j as r,w as c,l as x,G as M,x as S,H as E,J as j,k as D}from"../index56232.js";const I={setup(){R(()=>{n.value=!0,a.value={first:0,rows:m.value.rows,sortField:null,sortOrder:null,filters:p.value},K.register("myfilter",(t,y)=>t===y),l()});const i=V(),o=k(),d=g(()=>i.responseUsers),s=g(()=>i.userRoles),U=g(()=>i.status),h=N(),m=v(),u=v(),p=v({full_name:{value:"",matchMode:"like"},email:{value:"",matchMode:"like"}}),n=v(!0),a=v(),F=v(0),e=v([{label:"My Filter",value:"myfilter"}]);function l(){n.value=!0;let t=new Map;t=P(p,t),t.set("page",a.value.page+1),t.set("per_page",a.value.rows),a.value.sortField&&(a.value.sortOrder==1?t.set("sorted_by",a.value.sortField+"_asc"):t.set("sorted_by",a.value.sortField+"_desc")),setTimeout(()=>{f(t)},Math.random()*1e3+250)}const f=async function(t){await i.fetchAllUsers(t).then(()=>{n.value=!1}).catch(y=>{n.value=!1,T(h,y)})};return{dt:m,responseUsers:d,filters:p,loading:n,totalRecords:F,lazyParams:a,matchModes:e,userRoles:s,currentUser:u,status:U,onPage:t=>{a.value=t,l()},onSort:t=>{a.value=t,l()},onFilter:()=>{a.value.page=0,a.value.filters=p.value,l()},showSidebar:function(t){o.setDetailType("user",!1,"Dettaglio utente",t.id),o.updateSidebar(!0)},loadLazyData:l,changeStatus:async function(t){n.value=!0;const y={user_id:t.id,active:t==null?void 0:t.active};await i.changeStatus(y).then(()=>{n.value=!1,O(h,{message:"Stato aggiornato correttamente",error:!1}),l()}).catch(B=>{n.value=!1,T(h,B)})},prettyUserRole:z,formatDataFromUnixTimestamps:A}},components:{}};const q={class:"user-table"};function G(i,o,d,s,U,h){const m=_("InputText"),u=_("Column"),p=_("Badge"),n=_("Button"),a=_("DataTable"),F=$("tooltip");return b(),w("div",q,[r(a,{value:s.responseUsers.users,totalRecords:s.responseUsers.total,lazy:!0,paginator:!0,rows:30,filters:s.filters,"onUpdate:filters":o[0]||(o[0]=e=>s.filters=e),ref:"dt",dataKey:"id",loading:s.loading,onPage:o[1]||(o[1]=e=>s.onPage(e)),onSort:o[2]||(o[2]=e=>s.onSort(e)),onFilter:o[3]||(o[3]=e=>s.onFilter()),filterDisplay:"row",removableSort:"",stripedRows:""},{empty:c(()=>[x(" Nessun utente trovato. ")]),default:c(()=>[r(u,{field:"full_name",header:"Nome Cognome",filterMatchMode:"contains",ref:"full_name",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:c(({filterModel:e,filterCallback:l})=>[r(m,{type:"text",modelValue:e.value,"onUpdate:modelValue":f=>e.value=f,onKeydown:M(f=>l(),["enter"]),class:"p-column-filter",placeholder:"Filtra per cognome"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),body:c(({data:e})=>[x(S(e==null?void 0:e.first_name)+" "+S(e==null?void 0:e.last_name),1)]),_:1},512),r(u,{field:"email",header:"Email",filterMatchMode:"contains",ref:"email",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:c(({filterModel:e,filterCallback:l})=>[r(m,{type:"text",modelValue:e.value,"onUpdate:modelValue":f=>e.value=f,onKeydown:M(f=>l(),["enter"]),class:"p-column-filter",placeholder:"Filtra per email"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),r(u,{header:"Partner"},{body:c(({data:e})=>{var l;return[x(S((l=e.partner)==null?void 0:l.name),1)]}),_:1}),r(u,{header:"Stato"},{body:c(({data:e})=>[r(p,{value:e.active?"Attivo":"Disattivo",class:E(["px-4 border-round-lg h-auto font-medium line-height-4",e.active?"active":"expired"])},null,8,["value","class"])]),_:1}),r(u,{header:"",style:{width:"4rem"}},{body:c(({data:e})=>[j(r(n,{type:"button",onClick:l=>s.showSidebar(e),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-3",icon:"pi pi-arrow-right",text:"",rounded:""},null,8,["onClick"]),[[F,"Modifica",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","totalRecords","filters","loading"])])}const H=C(I,[["render",G]]),J={setup(){const i=V(),o=g(()=>i.getTotalUsers),d=k();return{totalUser:o,showSidebar:function(){d.setDetailType("user",!0,"Nuovo utente",null),d.updateSidebar(!0),d.setShowDetail(!0)}}},components:{UsersTable:H}},L={class:"flex justify-content-between align-items-center"},Q={class:""},W={key:0},X={key:1};function Y(i,o,d,s,U,h){const m=_("Button"),u=_("UsersTable");return b(),w("div",null,[D("div",L,[D("h1",Q,[s.totalUser==1?(b(),w("span",W," 1 Utente")):(b(),w("span",X,S(s.totalUser)+" Utenti",1))]),r(m,{label:"Aggiungi utente",onClick:o[0]||(o[0]=p=>s.showSidebar()),class:"mb-3",rounded:"",outlined:""})]),r(u)])}const le=C(J,[["render",Y]]);export{le as default};
