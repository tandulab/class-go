import{d as D,Y as x,Z as J,a as O,o as X,q as P,f as v,g as d,X as Y,r as m,E as Z,h as b,i as C,j as c,w as p,l as $,x as T,J as z,T as F,U as G,s as h,k as H}from"../index80269.js";const K={class:"col-5"},Q=D({__name:"PartnerTable",setup(S){const o=x(),i=J(),s=O();X(async()=>{await g(),f()});const l=P([]),_=P([]),a=P(!1),V=v(()=>o.allPartners),k=v(()=>o.getTotalPartners),B=v(()=>i.submitDialog);let u=null;const g=async()=>{a.value=!0;try{await o.fetchAllPartners(),E(),Object.assign(l.value,V.value),N()}catch(e){d(s,e)}finally{a.value=!1}},E=()=>{l.value.splice(0,l.value.length)},f=()=>{let e={name:"",id:"-1"};l.value.unshift(e),_.value.push(e)},N=()=>{l.value.sort(function(e,t){return e.created_at<t.created_at?1:e.created_at>t.created_at?-1:0})},A=async e=>{let{newData:t,index:n}=e;n===0&&t.name.length>0?await R(t):await U(t),await g(),f()},R=async e=>{const t={partner:{name:e.name}};a.value=!0;try{await o.addPartner(t),h(s,{message:"Partner aggiunto correttamente",title:""})}catch(n){d(s,n)}finally{a.value=!1}},U=async e=>{const t={partner:{name:e.name},id:e.id};a.value=!0;try{await o.updatePartner(t),h(s,{message:"Partner aggiornato correttamente",title:""})}catch(n){d(s,n)}finally{a.value=!1}},j=async()=>{a.value=!0;try{await o.removePartner(u),h(s,{message:"Partner rimosso correttamente",title:""})}catch(e){d(s,e)}finally{a.value=!1,await g(),f(),i.setBtnSubmit(!1),u=null}};Y(B,()=>{u&&j()});const L=(e,t)=>{u=t.data;let n="Sei sicuro di voler eliminare questo partner?";i.setDialog("Elimina partner","Conferma","Annulla",n),i.setDynamicDialogVisibility(!0)};return(e,t)=>{const n=m("InputText"),y=m("Column"),q=m("Button"),I=m("DataTable"),M=Z("tooltip");return b(),C("div",K,[c(I,{loading:a.value,value:l.value,"total-records":k.value,editMode:"row","editing-rows":_.value,"onUpdate:editingRows":t[0]||(t[0]=r=>_.value=r),onRowEditSave:A},{default:p(()=>[c(y,{field:"name",header:"Nome"},{body:p(({data:r})=>[$(T(r.name),1)]),editor:p(({data:r})=>[c(n,{modelValue:r.name,"onUpdate:modelValue":w=>r.name=w},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),c(y,{rowEditor:!0,bodyStyle:"text-align:end"}),c(y,null,{body:p(r=>[r.index!=0?z((b(),F(q,{key:0,onClick:w=>L(w,r),type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-400",icon:"pi pi-trash"},null,8,["onClick"])),[[M,"Elimina",void 0,{top:!0}]]):G("",!0)]),_:1})]),_:1},8,["loading","value","total-records","editing-rows"])])}}}),ee=D({__name:"PartnerView",setup(S){const o=x(),i=v(()=>o.getTotalPartners);return(s,l)=>(b(),C("div",null,[H("h1",null,T(i.value)+" Partner",1),c(Q)]))}});export{ee as default};
