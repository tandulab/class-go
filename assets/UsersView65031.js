import{o as I,y as K,t as M,z as $,f as D,a as V,q as h,A as L,g as F,B as P,C as A,s as R,_ as T,r as p,E as j,h as w,i as y,j as a,w as m,l as C,G as k,x,k as g,v as E,H as O,J as N,K as B,L as q,M as G,b as H,N as J}from"../index65031.js";const Q={setup(){I(()=>{l.value=!0,n.value={first:0,rows:c.value.rows,sortField:null,sortOrder:null,filters:u.value},K.register("myfilter",(s,S)=>s===S),d()});const i=M(),t=$(),v=D(()=>i.responseUsers),o=D(()=>i.userRoles),f=D(()=>i.status),_=V(),c=h(),r=h(),u=h({full_name:{value:"",matchMode:"like"},email:{value:"",matchMode:"like"}}),l=h(!0),n=h(),U=h(0),e=h([{label:"My Filter",value:"myfilter"}]);function d(){l.value=!0;let s=new Map;s=L(u,s),s.set("page",n.value.page+1),s.set("per_page",n.value.rows),n.value.sortField&&(n.value.sortOrder==1?s.set("sorted_by",n.value.sortField+"_asc"):s.set("sorted_by",n.value.sortField+"_desc")),setTimeout(()=>{b(s)},Math.random()*1e3+250)}const b=async function(s){await i.fetchAllUsers(s).then(()=>{l.value=!1}).catch(S=>{l.value=!1,F(_,S)})};return{dt:c,responseUsers:v,filters:u,loading:l,totalRecords:U,lazyParams:n,matchModes:e,userRoles:o,currentUser:r,status:f,onPage:s=>{n.value=s,d()},onSort:s=>{n.value=s,d()},onFilter:()=>{n.value.page=0,n.value.filters=u.value,d()},showSidebar:function(s){t.setDetailType("user",!1,"Dettaglio utente",s.id),t.updateSidebar(!0)},loadLazyData:d,changeStatus:async function(s){l.value=!0;const S={user_id:s.id,active:s==null?void 0:s.active};await i.changeStatus(S).then(()=>{l.value=!1,R(_,{message:"Stato aggiornato correttamente",error:!1}),d()}).catch(z=>{l.value=!1,F(_,z)})},prettyUserRole:P,formatDataFromUnixTimestamps:A}},components:{}};const W={class:"user-table"},X={class:"no-bullets"};function Y(i,t,v,o,f,_){const c=p("InputText"),r=p("Column"),u=p("Badge"),l=p("Button"),n=p("DataTable"),U=j("tooltip");return w(),y("div",W,[a(n,{value:o.responseUsers.users,totalRecords:o.responseUsers.total,lazy:!0,paginator:!0,rows:30,filters:o.filters,"onUpdate:filters":t[0]||(t[0]=e=>o.filters=e),ref:"dt",dataKey:"id",loading:o.loading,onPage:t[1]||(t[1]=e=>o.onPage(e)),onSort:t[2]||(t[2]=e=>o.onSort(e)),onFilter:t[3]||(t[3]=e=>o.onFilter()),filterDisplay:"row",removableSort:"",stripedRows:""},{empty:m(()=>[C(" Nessun utente trovato. ")]),default:m(()=>[a(r,{field:"full_name",header:"Nome Cognome",filterMatchMode:"contains",ref:"full_name",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:m(({filterModel:e,filterCallback:d})=>[a(c,{type:"text",modelValue:e.value,"onUpdate:modelValue":b=>e.value=b,onKeydown:k(b=>d(),["enter"]),class:"p-column-filter",placeholder:"Filtra per cognome"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),body:m(({data:e})=>[C(x(e==null?void 0:e.first_name)+" "+x(e==null?void 0:e.last_name),1)]),_:1},512),a(r,{field:"email",header:"Email",filterMatchMode:"contains",ref:"email",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:m(({filterModel:e,filterCallback:d})=>[a(c,{type:"text",modelValue:e.value,"onUpdate:modelValue":b=>e.value=b,onKeydown:k(b=>d(),["enter"]),class:"p-column-filter",placeholder:"Filtra per email"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),a(r,{header:"Partners"},{body:m(({data:e})=>[g("ul",X,[(w(!0),y(E,null,O(e.partners,(d,b)=>(w(),y("li",{key:b},x(d.name),1))),128))])]),_:1}),a(r,{header:"Ruolo",ref:"role",field:"role"},{body:m(({data:e})=>[e&&e.role?(w(),N(u,{key:0,value:o.prettyUserRole(e.role),class:B(["px-4 border-round-lg h-auto font-medium line-height-4",e.role])},null,8,["value","class"])):q("",!0)]),_:1},512),a(r,{header:"Stato"},{body:m(({data:e})=>[a(u,{value:e.active?"Attivo":"Disattivo",class:B(["px-4 border-round-lg h-auto font-medium line-height-4",e.active?"active":"expired"])},null,8,["value","class"])]),_:1}),a(r,{header:"",style:{width:"4rem"}},{body:m(({data:e})=>[G(a(l,{type:"button",onClick:d=>o.showSidebar(e),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-3",icon:"pi pi-arrow-right",text:"",rounded:""},null,8,["onClick"]),[[U,"Modifica",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","totalRecords","filters","loading"])])}const Z=T(Q,[["render",Y]]),ee={props:["isVisible"],setup(i){const t=h(!1),v=V(),{showLoader:o,hideLoader:f}=H(),_=M(),c=u=>{o();const l=new FormData;l.append("file",u.files[0]);const n={formData:l};_.importUser(n).then(()=>{}).catch(U=>{f(),F(v,U)})},r=function(){};return J(i,()=>{t.value=i.isVisible}),{visible:t,downloadTemplate:r,onUpload:c}}},te={class:"flex justify-content-between align-items-center w-full"},oe=g("h2",{class:"m-0"},"Importa utenti",-1),se={class:"mt-6"},le={class:"flex align-center justify-content-between mt-6 mb-3"};function ae(i,t,v,o,f,_){const c=p("Button"),r=p("FileUpload"),u=p("Dialog");return w(),N(u,{visible:o.visible,"onUpdate:visible":t[2]||(t[2]=l=>o.visible=l),modal:"",closable:!1},{header:m(()=>[g("div",te,[oe,a(c,{rounded:"",icon:"pi pi-times",onClick:t[0]||(t[0]=l=>i.$emit("closeDialog")),text:""})])]),default:m(()=>[g("p",se,[g("b",{class:"underline cursor-pointer",onClick:t[1]||(t[1]=l=>o.downloadTemplate())},"Scarica il template"),C(" e importa gli utenti ")]),g("div",le,[a(r,{mode:"basic",name:"demo[]",url:"./upload.php",accept:".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel",maxFileSize:1e6,onUploader:o.onUpload,customUpload:"",auto:!0,chooseLabel:"Carica file",rounded:"",outlined:"",severity:"contrast"},null,8,["onUploader"])])]),_:1},8,["visible"])}const ne=T(ee,[["render",ae]]),re={setup(){const i=M(),t=V(),v=h(!1),o=D(()=>i.getTotalUsers),f=$();return{totalUser:o,isVisible:v,showSidebar:function(){f.setDetailType("user",!0,"Nuovo utente",null),f.updateSidebar(!0),f.setShowDetail(!0)},showMsg:function(){R(t,{message:"Questa funzionalità non è al momento disponibile",error:!0})},onCloseDialog:function(){v.value=!1}}},components:{UsersTable:Z,ImportUsersDialog:ne}},ie={class:"flex justify-content-between align-items-center"},ce={class:""},ue={key:0},de={key:1};function me(i,t,v,o,f,_){const c=p("Button"),r=p("UsersTable"),u=p("ImportUsersDialog");return w(),y("div",null,[g("div",ie,[g("h1",ce,[o.totalUser==1?(w(),y("span",ue," 1 Utente")):(w(),y("span",de,x(o.totalUser)+" Utenti",1))]),g("div",null,[a(c,{icon:"pi pi-upload",class:"mb-3 mr-3",label:"Importa utenti",rounded:"",outlined:"",onClick:t[0]||(t[0]=l=>o.isVisible=!0)}),a(c,{icon:"pi pi-download",class:"mb-3 mr-3",label:"Esporta utenti",rounded:"",outlined:"",onClick:t[1]||(t[1]=l=>o.showMsg())}),a(c,{label:"Aggiungi utente",onClick:t[2]||(t[2]=l=>o.showSidebar()),class:"mb-3 bg-surface-800",rounded:"",severity:"contrast"})])]),a(r),a(u,{isVisible:o.isVisible,onCloseDialog:o.onCloseDialog},null,8,["isVisible","onCloseDialog"])])}const ge=T(re,[["render",me]]);export{ge as default};
