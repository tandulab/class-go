import{I as W}from"./InputTextWithValidation50555.js";import{u as D,d as E}from"./index.esm50555.js";import{f as q,h as r,a as b,s as y,e as x,d as O}from"./helpers50555.js";import{o as z,k as g,a as G,c as k,_ as H,r as f,b as L,e as J,g as l,f as v,w as N,q as T,v as B}from"../index50555.js";import{u as P}from"./location50555.js";/* empty css                                                                            */const Q={setup(){z(()=>{u()});const n=g({}),e=P(),m=g({}),o=g(void 0),s=G(),{handleSubmit:S,resetForm:_}=D();E("name",h);function h(){return!n.value.name||n.value.name==null?"Il nome Ã¨ obbligatorio":!0}const c=k(()=>e.getFormattedLocations),i=k(()=>e.getCurrentLocation),u=async function(){await e.fetchAllLocations().then(()=>{a()})},a=()=>{for(let t of c.value)K(t);m.value={...m.value}},K=t=>{if(t.children&&t.children.length){m.value[t.key]=!0;for(let d of t.children)K(d)}},C=function(){n.value.id=i.value.id,n.value.name=i.value.name,i.value.parent_id&&(n.value.branch_selected=O(i.value.parent_id,c.value))},F=async function(t){y(),e.getLocationsDetail(t).then(()=>{C(),r()}).catch(d=>{x(s,d),r()})},I=t=>{F(t.id)},p=function(){_(),n.value.id&&delete n.value.id,n.value.branch_selected&&(n.value.branch_selected={})},A=S(()=>{let t={name:n.value.name};if(n.value.branch_selected){var d=Object.keys(n.value.branch_selected)[0],V=q(d,c.value);V&&(t.parent_id=V+"")}const w={location:t};n.value.id?j(w):M(w)}),M=async function(t){await e.addLocation(t).then(()=>{r(),b(s,{message:"Sede creata correttamente.",title:""}),u(),p()})},U=async function(){y(),e.deleteLocation(n.value.id+"").then(()=>{r(),b(s,{message:"Sede eliminata con successo",title:""}),u(),p()}).catch(t=>{r(),x(s,t)})},j=async function(t){y(),t.location.id=n.value.id,e.updateLocation(t).then(()=>{b(s,{message:"Sede aggiornata correttamente",title:""}),u(),r(),p()}).catch(d=>{r(),x(s,d)})};return{tmp_branch:n,expandedKeys:m,selectedKey:o,locations:c,onSubmit:A,onNodeSelect:I,deleteLocation:U}},components:{InputTextWithValidation:W}},R=l("div",{class:"flex justify-content-between align-items-center"},[l("h1",null,"Nuova sede")],-1),X={class:"flex"},Y={class:"col-6 ml-0 pl-0"},Z={class:"formgrid grid mt-3"},$={class:"field col-12"},ee={class:"field col-12 flex flex-column"},te=l("label",{for:"role"},"Sede",-1),oe={class:"flex justify-content-end mt-3"},ne={class:"col-6"};function ae(n,e,m,o,s,S){const _=f("InputTextWithValidation"),h=f("TreeSelect"),c=f("Button"),i=f("Card"),u=f("Tree");return L(),J("div",null,[R,l("div",X,[l("div",Y,[v(i,null,{content:N(()=>[l("form",{onSubmit:e[3]||(e[3]=(...a)=>o.onSubmit&&o.onSubmit(...a)),class:"flex flex-column"},[l("div",Z,[l("div",$,[v(_,{name:"name",label:"Nome*",modelValue:o.tmp_branch.name,class:"w-full","onUpdate:modelValue":e[0]||(e[0]=a=>o.tmp_branch.name=a)},null,8,["modelValue"])]),l("div",ee,[te,v(h,{modelValue:o.tmp_branch.branch_selected,"onUpdate:modelValue":e[1]||(e[1]=a=>o.tmp_branch.branch_selected=a),options:o.locations,placeholder:"",class:"w-full",selectionMode:"single"},null,8,["modelValue","options"])])]),l("div",oe,[o.tmp_branch.id?(L(),T(c,{key:0,label:"Elimina sede",rounded:"",text:"",class:"mr-1",onClick:e[2]||(e[2]=a=>o.deleteLocation())})):B("",!0),v(c,{type:"submit",label:o.tmp_branch.id?"Modifica sede":"Aggiungi sede",rounded:"",outlined:""},null,8,["label"])])],32)]),_:1})]),l("div",ne,[o.locations?(L(),T(i,{key:0},{content:N(()=>[v(u,{value:o.locations,class:"w-full",expandedKeys:o.expandedKeys,"onUpdate:expandedKeys":e[4]||(e[4]=a=>o.expandedKeys=a),selectionKeys:o.selectedKey,"onUpdate:selectionKeys":e[5]||(e[5]=a=>o.selectedKey=a),onNodeSelect:o.onNodeSelect,selectionMode:"single"},null,8,["value","expandedKeys","selectionKeys","onNodeSelect"])]),_:1})):B("",!0)])])])}const ue=H(Q,[["render",ae]]);export{ue as default};
