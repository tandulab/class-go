import{o as L,W as R,z as N,X as Z,t as $,u as O,f as h,a as ee,q as c,b as te,g as oe,Y as ae,A as ne,_ as B,r as S,E as le,h as U,i as z,k as m,x as v,j as s,L as se,V as re,w as r,l as b,G as q,H as ie,J as ue,D as ce}from"../index87980.js";const de={setup(){L(()=>{V.value=!0,u.value={first:0,page:0,rows:x.value.rows,sortField:null,sortOrder:null,filters:T.value},E(),X(),Q()});const f=R(),n=N(),_=Z(),o=$(),g=O(),M=h(()=>f.responseEvaluations),d=h(()=>f.evaluationTypes),i=h(()=>_.allPartners),p=h(()=>o.allUsers),w=h(()=>g.isUserAdmin),D=ee(),x=c(),e=c(),l=c(),a=c(),{showLoader:A,hideLoader:F}=te(),T=c({cf:{value:"",matchMode:"eq"},piva:{value:"",matchMode:"eq"},created_at:{value:"",matchMode:"eq"},partner_id_eq:{value:"",matchMode:"eq"},created_by:{value:"",matchMode:"eq"}}),V=c(!0),u=c(),K=c(0),P=c([{label:"Attivo",value:"true"},{label:"Disattivo",value:"false"}]),j=c([{label:"Utente",value:"evaluation"},{label:"Admin",value:"admin"}]),H=c([{label:"My Filter",value:"myfilter"}]),k=function(t){return t=ne(T,t),t.set("page",u.value.page+1),t.set("per_page",u.value.rows),u.value.sortField&&(u.value.sortOrder==1?t.set("sorted_by",u.value.sortField+"_asc"):t.set("sorted_by",u.value.sortField+"_desc")),t};function E(){V.value=!0;let t=new Map;k(t),setTimeout(()=>{I(t)},Math.random()*1e3+250)}const I=async function(t){await f.fetchAllEvaluations(t).then(()=>{V.value=!1}).catch(y=>{V.value=!1,oe(D,y)})},G=t=>{u.value=t,E()},W=t=>{u.value=t,E()},Y=()=>{u.value.page=0,u.value.filters=T.value,E()},J=function(t){n.setDetailType("evaluationS",!1,"Dettaglio valutazione",null,!1,!1,t),n.updateSidebar(!0)},X=async function(){await _.fetchAllPartners()},Q=async function(){let t=new Map;t.set("page",1),t.set("per_page",1e11),await o.fetchAllUsers(t)};return{dt:x,responseEvaluations:M,filters:T,loading:V,totalRecords:K,lazyParams:u,matchModes:H,status:P,roles:j,currentEvaluation:e,evaluationTypes:d,partners:l,allPartner:i,allUsers:p,users:a,isAdmin:w,onPage:G,onSort:W,onFilter:Y,showSidebar:J,loadLazyData:E,searchPartner:t=>{const y=t.query.toLowerCase();l.value=i.value.filter(C=>C.name.toLowerCase().startsWith(y))},searchUser:t=>{const y=t.query.toLowerCase();a.value=p.value.filter(C=>(C.first_name.toLowerCase()+" "+C.last_name.toLowerCase()).includes(y)||C.email.toLowerCase().includes(y))},downloadReport:async function(){A();let t=new Map;k(t),await f.getEvaluationsReport(t).then(()=>{F()}).catch(()=>{F()})},showSidebarNewEvaluation:function(){n.setDetailType("newEvaluationS",!0,"Nuova valutazione",null),n.updateSidebar(!0),n.setShowDetail(!0)},formatDataAndHourFromUnixTimestamps:ae}},components:{}};const ve={class:"flex justify-content-between align-items-center"},fe={class:""},pe={key:0},me={key:1},he=m("div",{class:"flex justify-content-center w-full"},"Semaforo",-1);function _e(f,n,_,o,g,M){const d=S("Button"),i=S("Column"),p=S("InputText"),w=S("AutoComplete"),D=S("DataTable"),x=le("tooltip");return U(),z("div",null,[m("div",ve,[m("h1",fe,[o.responseEvaluations.total==1?(U(),z("span",pe," 1 Valutazione")):(U(),z("span",me,v(o.responseEvaluations.total)+" Valutazioni",1))]),m("div",null,[s(d,{icon:"pi pi-download",class:"mb-3 mr-3",label:"Esporta report",rounded:"",outlined:"",onClick:n[0]||(n[0]=e=>o.downloadReport())}),o.isAdmin?re("",!0):(U(),se(d,{key:0,label:"Aggiungi valutazione",class:"mb-3",rounded:"",outlined:"",onClick:n[1]||(n[1]=e=>o.showSidebarNewEvaluation()),severity:"contrast"}))])]),s(D,{value:o.responseEvaluations.cqs_evaluations,totalRecords:o.responseEvaluations.total,lazy:!0,paginator:!0,rows:30,filters:o.filters,"onUpdate:filters":n[2]||(n[2]=e=>o.filters=e),ref:"dt",dataKey:"id",loading:o.loading,onPage:n[3]||(n[3]=e=>o.onPage(e)),onSort:n[4]||(n[4]=e=>o.onSort(e)),onFilter:n[5]||(n[5]=e=>o.onFilter()),filterDisplay:"row",removableSort:"",stripedRows:""},{empty:r(()=>[b(" Nessuna richiesta trovata. ")]),default:r(()=>[s(i,{header:"Data e ora",field:"created_at",ref:"created_at"},{body:r(({data:e})=>[b(v(o.formatDataAndHourFromUnixTimestamps(e==null?void 0:e.created_at)),1)]),_:1},512),s(i,{header:"Codice fiscale",ref:"cf",field:"cf",filterMatchMode:"contains",sortable:!0,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:r(({filterModel:e,filterCallback:l})=>[s(p,{type:"text",modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,onKeydown:q(a=>l(),["enter"]),class:"p-column-filter",placeholder:"Filtra per codice fiscale"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),s(i,{header:"PIVA",ref:"piva",field:"piva",filterMatchMode:"contains",sortable:!0,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:r(({filterModel:e,filterCallback:l})=>[s(p,{type:"text",modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,onKeydown:q(a=>l(),["enter"]),class:"p-column-filter",placeholder:"Filtra per partita iva"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),s(i,{field:"denominazione",header:"Denominazione",ref:"denominazione"},{body:r(({data:e})=>[b(v(e==null?void 0:e.denominazione),1)]),_:1},512),s(i,{field:"created_by",header:"Richiedente",filterMatchMode:"contains",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:r(({filterModel:e,filterCallback:l})=>[s(w,{modelValue:e.value,"onUpdate:modelValue":[a=>e.value=a,l],suggestions:o.users,onComplete:o.searchUser,optionLabel:"name",optionValue:"id",class:"w-full capitalize",placeholder:"Filtra per richiedente"},{option:r(a=>{var A,F;return[m("div",null,v((A=a==null?void 0:a.option)==null?void 0:A.first_name)+" "+v((F=a==null?void 0:a.option)==null?void 0:F.last_name),1)]}),_:2},1032,["modelValue","onUpdate:modelValue","suggestions","onComplete"])]),body:r(({data:e})=>{var l,a;return[b(v((l=e==null?void 0:e.created_by)==null?void 0:l.first_name)+" "+v((a=e==null?void 0:e.created_by)==null?void 0:a.last_name),1)]}),_:1}),s(i,{field:"partner_id_eq",ref:"partner_id_eq",header:"Partner",filterMatchMode:"contains",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:r(({filterModel:e,filterCallback:l})=>[s(w,{modelValue:e.value,"onUpdate:modelValue":[a=>e.value=a,l],suggestions:o.partners,onComplete:o.searchPartner,optionLabel:"name",optionValue:"id",class:"w-full capitalize",placeholder:"Filtra per partner"},{option:r(a=>[m("div",null,v(a.option.name),1)]),_:2},1032,["modelValue","onUpdate:modelValue","suggestions","onComplete"])]),body:r(({data:e})=>{var l;return[b(v((l=e==null?void 0:e.created_by)==null?void 0:l.partner_name),1)]}),_:1},512),s(i,{header:"",class:"text-center"},{header:r(()=>[he]),body:r(({data:e})=>[m("i",{class:ie(["pi pi-circle-fill block text-center",{"text-red-600":e.semaforo=="R","text-yellow-50":e.semaforo=="G","text-green-300":e.semaforo=="V"}])},null,2)]),_:1}),s(i,{header:"Valutazione",ref:"valutazioni"},{body:r(({data:e})=>[b(v(e.valutazione),1)]),_:1},512),s(i,{header:"",style:{width:"4rem"}},{body:r(({data:e})=>[ue(s(d,{type:"button",onClick:l=>o.showSidebar(e),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-3",icon:"pi pi-arrow-right",text:"",rounded:""},null,8,["onClick"]),[[x,"Modifica",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","totalRecords","filters","loading"])])}const we=B(de,[["render",_e]]),ye={setup(){L(()=>{const d=ce.now(),i=d.startOf("week").toFormat("dd"),p=d.endOf("week").toFormat("dd"),w=d.toFormat("MMMM yyyy");o.value=`${i}/${p} ${w}`});const f=O(),n=R(),_=N(),o=c(),g=h(()=>n.getTotalEvaluations),M=h(()=>f.isUserAdmin);return{totalEvaluation:g,weekDate:o,isAdmin:M,sidebarStore:_}},components:{EvaluationsSTable:we}};function be(f,n,_,o,g,M){const d=S("EvaluationsSTable");return U(),z("div",null,[s(d)])}const Ee=B(ye,[["render",be]]);export{Ee as default};
