import{o as P,y as A,t as C,z as N,f as D,a as V,q as b,A as O,g as x,B as k,C as B,E as j,s as z,_ as T,r as m,G as E,h as w,i as U,j as a,w as d,l as F,H as R,x as M,k as h,v as q,J as G,K as I,L as $,M as H,N as J,b as Q,O as W}from"../index97276.js";const X={setup(){P(()=>{u.value=!0,r.value={first:0,rows:l.value.rows,sortField:null,sortOrder:null,filters:n.value},A.register("myfilter",(s,S)=>s===S),c()});const p=function(s){return B(s)?"Mediatore":k(s.role)},t=C(),f=N(),o=D(()=>t.responseUsers),v=D(()=>t.userRoles),y=D(()=>t.status),i=V(),l=b(),_=b(),n=b({full_name:{value:"",matchMode:"like"},email:{value:"",matchMode:"like"}}),u=b(!0),r=b(),e=b(0),g=b([{label:"My Filter",value:"myfilter"}]);function c(){u.value=!0;let s=new Map;s=O(n,s),s.set("page",r.value.page+1),s.set("per_page",r.value.rows),r.value.sortField&&(r.value.sortOrder==1?s.set("sorted_by",r.value.sortField+"_asc"):s.set("sorted_by",r.value.sortField+"_desc")),setTimeout(()=>{K(s)},Math.random()*1e3+250)}const K=async function(s){await t.fetchAllUsers(s).then(()=>{u.value=!1}).catch(S=>{u.value=!1,x(i,S)})};return{dt:l,responseUsers:o,filters:n,loading:u,totalRecords:e,lazyParams:r,matchModes:g,userRoles:v,currentUser:_,status:y,onPage:s=>{r.value=s,c()},onSort:s=>{r.value=s,c()},onFilter:()=>{r.value.page=0,r.value.filters=n.value,c()},showSidebar:function(s){f.setDetailType("user",!1,"Dettaglio utente",s.id),f.updateSidebar(!0)},loadLazyData:c,changeStatus:async function(s){u.value=!0;const S={user_id:s.id,active:s==null?void 0:s.active};await t.changeStatus(S).then(()=>{u.value=!1,z(i,{message:"Stato aggiornato correttamente",error:!1}),c()}).catch(L=>{u.value=!1,x(i,L)})},prettyUserRole:k,prettyUserRoleMediator:p,isUserMediator:B,formatDataFromUnixTimestamps:j}},components:{}};const Y={class:"user-table"},Z={class:"no-bullets"};function ee(p,t,f,o,v,y){const i=m("InputText"),l=m("Column"),_=m("Badge"),n=m("Button"),u=m("DataTable"),r=E("tooltip");return w(),U("div",Y,[a(u,{value:o.responseUsers.users,totalRecords:o.responseUsers.total,lazy:!0,paginator:!0,rows:30,filters:o.filters,"onUpdate:filters":t[0]||(t[0]=e=>o.filters=e),ref:"dt",dataKey:"id",loading:o.loading,onPage:t[1]||(t[1]=e=>o.onPage(e)),onSort:t[2]||(t[2]=e=>o.onSort(e)),onFilter:t[3]||(t[3]=e=>o.onFilter()),filterDisplay:"row",removableSort:"",stripedRows:""},{empty:d(()=>[F(" Nessun utente trovato. ")]),default:d(()=>[a(l,{field:"full_name",header:"Nome Cognome",filterMatchMode:"contains",ref:"full_name",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:d(({filterModel:e,filterCallback:g})=>[a(i,{type:"text",modelValue:e.value,"onUpdate:modelValue":c=>e.value=c,onKeydown:R(c=>g(),["enter"]),class:"p-column-filter",placeholder:"Filtra per cognome"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),body:d(({data:e})=>[F(M(e==null?void 0:e.first_name)+" "+M(e==null?void 0:e.last_name),1)]),_:1},512),a(l,{field:"email",header:"Email",filterMatchMode:"contains",ref:"email",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:d(({filterModel:e,filterCallback:g})=>[a(i,{type:"text",modelValue:e.value,"onUpdate:modelValue":c=>e.value=c,onKeydown:R(c=>g(),["enter"]),class:"p-column-filter",placeholder:"Filtra per email"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),a(l,{header:"Partners"},{body:d(({data:e})=>[h("ul",Z,[(w(!0),U(q,null,G(e.partners,(g,c)=>(w(),U("li",{key:c},M(g.name),1))),128))])]),_:1}),a(l,{header:"Ruolo",ref:"role",field:"role"},{body:d(({data:e})=>[e&&e.role?(w(),I(_,{key:0,value:o.prettyUserRoleMediator(e),class:$(["px-4 border-round-lg h-auto font-medium line-height-4",o.isUserMediator(e)?"mediatore":e.role])},null,8,["value","class"])):H("",!0)]),_:1},512),a(l,{header:"Stato"},{body:d(({data:e})=>[a(_,{value:e.active?"Attivo":"Disattivo",class:$(["px-4 border-round-lg h-auto font-medium line-height-4",e.active?"active":"expired"])},null,8,["value","class"])]),_:1}),a(l,{header:"",style:{width:"4rem"}},{body:d(({data:e})=>[J(a(n,{type:"button",onClick:g=>o.showSidebar(e),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-3",icon:"pi pi-arrow-right",text:"",rounded:""},null,8,["onClick"]),[[r,"Modifica",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","totalRecords","filters","loading"])])}const te=T(X,[["render",ee]]),oe={props:["isVisible"],setup(p){const t=b(!1),f=V(),{showLoader:o,hideLoader:v}=Q(),y=C(),i=_=>{o();const n=new FormData;n.append("file",_.files[0]);const u={formData:n};y.importUser(u).then(()=>{}).catch(r=>{v(),x(f,r)})},l=function(){};return W(p,()=>{t.value=p.isVisible}),{visible:t,downloadTemplate:l,onUpload:i}}},se={class:"flex justify-content-between align-items-center w-full"},ae=h("h2",{class:"m-0"},"Importa utenti",-1),le={class:"mt-6"},ne={class:"flex align-center justify-content-between mt-6 mb-3"};function re(p,t,f,o,v,y){const i=m("Button"),l=m("FileUpload"),_=m("Dialog");return w(),I(_,{visible:o.visible,"onUpdate:visible":t[2]||(t[2]=n=>o.visible=n),modal:"",closable:!1},{header:d(()=>[h("div",se,[ae,a(i,{rounded:"",icon:"pi pi-times",onClick:t[0]||(t[0]=n=>p.$emit("closeDialog")),text:""})])]),default:d(()=>[h("p",le,[h("b",{class:"underline cursor-pointer",onClick:t[1]||(t[1]=n=>o.downloadTemplate())},"Scarica il template"),F(" e importa gli utenti ")]),h("div",ne,[a(l,{mode:"basic",name:"demo[]",url:"./upload.php",accept:".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel",maxFileSize:1e6,onUploader:o.onUpload,customUpload:"",auto:!0,chooseLabel:"Carica file",rounded:"",outlined:"",severity:"contrast"},null,8,["onUploader"])])]),_:1},8,["visible"])}const ie=T(oe,[["render",re]]),ce={setup(){const p=C(),t=V(),f=b(!1),o=D(()=>p.getTotalUsers),v=N();return{totalUser:o,isVisible:f,showSidebar:function(){v.setDetailType("user",!0,"Nuovo utente",null),v.updateSidebar(!0),v.setShowDetail(!0)},showMsg:function(){z(t,{message:"Questa funzionalità non è al momento disponibile",error:!0})},onCloseDialog:function(){f.value=!1}}},components:{UsersTable:te,ImportUsersDialog:ie}},ue={class:"flex justify-content-between align-items-center"},de={class:""},me={key:0},pe={key:1};function fe(p,t,f,o,v,y){const i=m("Button"),l=m("UsersTable"),_=m("ImportUsersDialog");return w(),U("div",null,[h("div",ue,[h("h1",de,[o.totalUser==1?(w(),U("span",me," 1 Utente")):(w(),U("span",pe,M(o.totalUser)+" Utenti",1))]),h("div",null,[a(i,{icon:"pi pi-upload",class:"mb-3 mr-3",label:"Importa utenti",rounded:"",outlined:"",onClick:t[0]||(t[0]=n=>o.isVisible=!0)}),a(i,{icon:"pi pi-download",class:"mb-3 mr-3",label:"Esporta utenti",rounded:"",outlined:"",onClick:t[1]||(t[1]=n=>o.showMsg())}),a(i,{label:"Aggiungi utente",onClick:t[2]||(t[2]=n=>o.showSidebar()),class:"mb-3 bg-surface-800",rounded:"",severity:"contrast"})])]),a(l),a(_,{isVisible:o.isVisible,onCloseDialog:o.onCloseDialog},null,8,["isVisible","onCloseDialog"])])}const ye=T(ce,[["render",fe]]);export{ye as default};
