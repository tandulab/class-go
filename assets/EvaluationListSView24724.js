import{o as D,l as V,m as x,u as T,c as M,a as U,k as r,_ as k,r as p,n as B,b as S,e as y,f as s,w as u,g as h,h as _,t as d,s as O,x as N,q as R,v as P}from"../index24724.js";import{u as z}from"./evaluation24724.js";import{e as I,g as L,D as j}from"./helpers24724.js";const H={setup(){D(()=>{i.value=!0,n.value={first:0,rows:f.value.rows,sortField:null,sortOrder:null,filters:t.value},V.register("myfilter",(o,F)=>o===F),w()});const v=z(),l=x(),c=T(),a=M(()=>v.responseEvaluations);M(()=>c.user);const b=U(),f=r(),m=r(),t=r({global:{value:null,matchMode:"contains"},full_name:{value:"",matchMode:"contains"},email:{value:"",matchMode:"contains"},company_name:{value:"",matchMode:"contains"},created_at:{value:"",matchMode:"contains"},cf_piva:{value:"",matchMode:"contains"},ragioneSociale:{value:"",matchMode:"contains"}}),i=r(!0),n=r(),g=r(0),e=r([{label:"Attivo",value:"true"},{label:"Disattivo",value:"false"}]),E=r([{label:"Utente",value:"evaluation"},{label:"Admin",value:"admin"}]),C=r([{label:"My Filter",value:"myfilter"}]);function w(){i.value=!0;const o=new Map;o.set("piva",t.value.global.value),o.set("company_name",t.value.company_name.value),o.set("email",t.value.email.value),o.set("full_name",t.value.full_name.value),o.set("ragioneSociale",t.value.cf_piva.value),o.set("page",n.value.page+1),o.set("per_page",n.value.rows),n.value.sortField&&(n.value.sortOrder==1?o.set("sorted_by",n.value.sortField+"_asc"):o.set("sorted_by",n.value.sortField+"_desc")),setTimeout(()=>{A(o)},Math.random()*1e3+250)}const A=async function(o){await v.fetchAllEvaluations(o).then(()=>{i.value=!1}).catch(F=>{i.value=!1,I(b,F)})};return{dt:f,responseEvaluations:a,filters:t,loading:i,totalRecords:g,lazyParams:n,matchModes:C,status:e,roles:E,currentEvaluation:m,onPage:o=>{n.value=o,w()},onSort:o=>{n.value=o,w()},onFilter:()=>{n.value.page=0,n.value.filters=t.value,w()},showSidebar:function(o){l.setDetailType("evaluationS",!1,"Dettaglio valutazione",o.id,!1,!1),l.updateSidebar(!0)},loadLazyData:w,formatDataAndHourFromUnixTimestamps:L}},components:{}};const $={class:"flex justify-content-between align-items-center"},q={class:"p-input-icon-left w-full mr-3 py-2"},K=h("i",{class:"pi pi-search"},null,-1);function Y(v,l,c,a,b,f){const m=p("InputText"),t=p("Column"),i=p("Button"),n=p("DataTable"),g=B("tooltip");return S(),y("div",null,[s(n,{value:a.responseEvaluations.users,totalRecords:a.responseEvaluations.total,lazy:!0,paginator:!0,rows:30,filters:a.filters,"onUpdate:filters":l[1]||(l[1]=e=>a.filters=e),ref:"dt",dataKey:"id",loading:a.loading,onPage:l[2]||(l[2]=e=>a.onPage(e)),onSort:l[3]||(l[3]=e=>a.onSort(e)),onFilter:l[4]||(l[4]=e=>a.onFilter()),removableSort:"",stripedRows:""},{header:u(()=>[h("div",$,[h("span",q,[K,s(m,{modelValue:a.filters.global.value,"onUpdate:modelValue":l[0]||(l[0]=e=>a.filters.global.value=e),placeholder:"Ricerca per partita iva",class:"border-none w-full",onChange:a.loadLazyData},null,8,["modelValue","onChange"])])])]),empty:u(()=>[_(" Nessuna richiesta trovata. ")]),default:u(()=>[s(t,{header:"Data e ora",field:"created_at",filterMatchMode:"contains",ref:"created_at",sortable:!0,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:u(({data:e})=>[_(d(a.formatDataAndHourFromUnixTimestamps(e==null?void 0:e.created_at)),1)]),_:1},512),s(t,{header:"P.Iva",filterMatchMode:"contains",ref:"cf_piva",field:"cf_piva",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},null,512),s(t,{field:"ragioneSociale",header:"Ragione Sociale",filterMatchMode:"contains",ref:"ragioneSociale",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:u(({data:e})=>[_(d(e.ragione_sociale&&e.ragione_sociale.length>30?e.ragione_sociale.substring(0,30)+"...":e.ragione_sociale),1)]),_:1},512),s(t,{field:"full_name",header:"Utente",filterMatchMode:"contains",ref:"full_name",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:u(({data:e})=>[_(d(e.first_name)+" "+d(e.last_name),1)]),_:1},512),s(t,{header:"Valutazione"},{body:u(({data:e})=>[h("i",{class:O(["pi pi-circle-fill mr-2",{"text-red-600":e.valutazioni=="Non solvibile","text-green-300":e.valutazioni=="Solvibile"}])},null,2),_(" "+d(e.valutazioni),1)]),_:1}),s(t,{header:"Report",filterMatchMode:"contains"},{body:u(({data:e})=>[_(d(e.pdf_url?e.pdf_approfondito_url?"2 allegati":"1 allegato":"0 allegati"),1)]),_:1}),s(t,{header:"",style:{width:"4rem"}},{body:u(({data:e})=>[N(s(i,{type:"button",onClick:E=>a.showSidebar(e),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-3",icon:"pi pi-arrow-right",text:"",rounded:""},null,8,["onClick"]),[[g,"Edit",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","totalRecords","filters","loading"])])}const G=k(H,[["render",Y]]),J={setup(){D(()=>{const t=j.now(),i=t.startOf("week").toFormat("dd"),n=t.endOf("week").toFormat("dd"),g=t.toFormat("MMMM yyyy");a.value=`${i}/${n} ${g}`});const v=T(),l=z(),c=x(),a=r(),b=M(()=>l.getTotalEvaluations),f=M(()=>v.isUserAdmin);return{totalEvaluation:b,weekDate:a,isAdmin:f,sidebarStore:c,showSidebar:function(){c.setDetailType("newEvaluationS",!0,"Nuova valutazione",null),c.updateSidebar(!0),c.setShowDetail(!0)}}},components:{EvaluationsSTable:G}},Q={class:"flex justify-content-between align-items-center"},W={class:""},X={key:0},Z={key:1};function ee(v,l,c,a,b,f){const m=p("Button"),t=p("EvaluationsSTable");return S(),y("div",null,[h("div",Q,[h("h1",W,[a.totalEvaluation==1?(S(),y("span",X," 1 Valutazione")):(S(),y("span",Z,d(a.totalEvaluation)+" Valutazioni",1))]),a.isAdmin?P("",!0):(S(),R(m,{key:0,label:"Aggiungi valutazione",class:"mb-3",rounded:"",outlined:"",onClick:l[0]||(l[0]=i=>a.showSidebar())}))]),s(t)])}const re=k(J,[["render",ee]]);export{re as default};
