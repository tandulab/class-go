import{d as D,Y as x,$,a as K,o as O,q as P,f as v,g as d,L as W,r as m,E as Y,h as b,i as C,j as c,w as p,l as z,x as S,K as F,M as G,W as H,s as h,k as J}from"../index41704.js";const Q={class:"col-5"},X=D({__name:"PartnerTable",setup(T){const o=x(),i=$(),s=K();O(async()=>{await f(),g()});const l=P([]),_=P([]),a=P(!1),V=v(()=>o.allPartners),k=v(()=>o.getTotalPartners),B=v(()=>i.submitDialog);let u=null;const f=async()=>{a.value=!0;try{await o.fetchAllPartners(),E(),Object.assign(l.value,V.value),N()}catch(e){d(s,e)}finally{a.value=!1}},E=()=>{l.value.splice(0,l.value.length)},g=()=>{let e={name:"",id:"-1"};l.value.unshift(e),_.value.push(e)},N=()=>{l.value.sort(function(e,t){return e.created_at<t.created_at?1:e.created_at>t.created_at?-1:0})},A=async e=>{let{newData:t,index:n}=e;if(n===0)if(t.name.length>0)await L(t);else return;else await R(t);await f(),g()},L=async e=>{const t={partner:{name:e.name}};a.value=!0;try{await o.addPartner(t),h(s,{message:"Partner aggiunto correttamente",title:""})}catch(n){d(s,n)}finally{a.value=!1}},R=async e=>{const t={partner:{name:e.name},id:e.id};a.value=!0;try{await o.updatePartner(t),h(s,{message:"Partner aggiornato correttamente",title:""})}catch(n){d(s,n)}finally{a.value=!1}},j=async()=>{a.value=!0;try{await o.removePartner(u),h(s,{message:"Partner rimosso correttamente",title:""})}catch(e){d(s,e)}finally{a.value=!1,await f(),g(),i.setBtnSubmit(!1),u=null}};W(B,()=>{u&&j()});const M=(e,t)=>{u=t.data;let n="Sei sicuro di voler eliminare questo partner?";i.setDialog("Elimina partner","Conferma","Annulla",n),i.setDynamicDialogVisibility(!0)};return(e,t)=>{const n=m("InputText"),y=m("Column"),U=m("Button"),q=m("DataTable"),I=Y("tooltip");return b(),C("div",Q,[c(q,{loading:a.value,value:l.value,"total-records":k.value,editMode:"row","editing-rows":_.value,"onUpdate:editingRows":t[0]||(t[0]=r=>_.value=r),onRowEditSave:A},{default:p(()=>[c(y,{field:"name",header:"Nome"},{body:p(({data:r})=>[z(S(r.name),1)]),editor:p(({data:r})=>[c(n,{modelValue:r.name,"onUpdate:modelValue":w=>r.name=w},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),c(y,{rowEditor:!0,bodyStyle:"text-align:end"}),c(y,null,{body:p(r=>[r.index!=0?F((b(),G(U,{key:0,onClick:w=>M(w,r),type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-400",icon:"pi pi-trash"},null,8,["onClick"])),[[I,"Elimina",void 0,{top:!0}]]):H("",!0)]),_:1})]),_:1},8,["loading","value","total-records","editing-rows"])])}}}),ee=D({__name:"PartnerView",setup(T){const o=x(),i=v(()=>o.getTotalPartners);return(s,l)=>(b(),C("div",null,[J("h1",null,S(i.value)+" Partner",1),c(X)]))}});export{ee as default};
