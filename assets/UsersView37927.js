import{o as K,y as N,t as C,z as D,f as w,a as V,q as f,A as P,g as T,B as A,C as E,s as B,_ as R,r as v,E as O,h as y,i as S,j as l,w as m,l as F,G as k,x as U,H as $,J as I,k as x}from"../index37927.js";const j={setup(){K(()=>{r.value=!0,a.value={first:0,rows:u.value.rows,sortField:null,sortOrder:null,filters:d.value},N.register("myfilter",(t,g)=>t===g),n()});const i=C(),s=D(),h=w(()=>i.responseUsers),o=w(()=>i.userRoles),b=w(()=>i.status),_=V(),u=f(),c=f(),d=f({full_name:{value:"",matchMode:"like"},email:{value:"",matchMode:"like"}}),r=f(!0),a=f(),M=f(0),e=f([{label:"My Filter",value:"myfilter"}]);function n(){r.value=!0;let t=new Map;t=P(d,t),t.set("page",a.value.page+1),t.set("per_page",a.value.rows),a.value.sortField&&(a.value.sortOrder==1?t.set("sorted_by",a.value.sortField+"_asc"):t.set("sorted_by",a.value.sortField+"_desc")),setTimeout(()=>{p(t)},Math.random()*1e3+250)}const p=async function(t){await i.fetchAllUsers(t).then(()=>{r.value=!1}).catch(g=>{r.value=!1,T(_,g)})};return{dt:u,responseUsers:h,filters:d,loading:r,totalRecords:M,lazyParams:a,matchModes:e,userRoles:o,currentUser:c,status:b,onPage:t=>{a.value=t,n()},onSort:t=>{a.value=t,n()},onFilter:()=>{a.value.page=0,a.value.filters=d.value,n()},showSidebar:function(t){s.setDetailType("user",!1,"Dettaglio utente",t.id),s.updateSidebar(!0)},loadLazyData:n,changeStatus:async function(t){r.value=!0;const g={user_id:t.id,active:t==null?void 0:t.active};await i.changeStatus(g).then(()=>{r.value=!1,B(_,{message:"Stato aggiornato correttamente",error:!1}),n()}).catch(z=>{r.value=!1,T(_,z)})},prettyUserRole:A,formatDataFromUnixTimestamps:E}},components:{}};const q={class:"user-table"};function G(i,s,h,o,b,_){const u=v("InputText"),c=v("Column"),d=v("Badge"),r=v("Button"),a=v("DataTable"),M=O("tooltip");return y(),S("div",q,[l(a,{value:o.responseUsers.users,totalRecords:o.responseUsers.total,lazy:!0,paginator:!0,rows:30,filters:o.filters,"onUpdate:filters":s[0]||(s[0]=e=>o.filters=e),ref:"dt",dataKey:"id",loading:o.loading,onPage:s[1]||(s[1]=e=>o.onPage(e)),onSort:s[2]||(s[2]=e=>o.onSort(e)),onFilter:s[3]||(s[3]=e=>o.onFilter()),filterDisplay:"row",removableSort:"",stripedRows:""},{empty:m(()=>[F(" Nessun utente trovato. ")]),default:m(()=>[l(c,{field:"full_name",header:"Nome Cognome",filterMatchMode:"contains",ref:"full_name",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:m(({filterModel:e,filterCallback:n})=>[l(u,{type:"text",modelValue:e.value,"onUpdate:modelValue":p=>e.value=p,onKeydown:k(p=>n(),["enter"]),class:"p-column-filter",placeholder:"Filtra per cognome"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),body:m(({data:e})=>[F(U(e==null?void 0:e.first_name)+" "+U(e==null?void 0:e.last_name),1)]),_:1},512),l(c,{field:"email",header:"Email",filterMatchMode:"contains",ref:"email",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:m(({filterModel:e,filterCallback:n})=>[l(u,{type:"text",modelValue:e.value,"onUpdate:modelValue":p=>e.value=p,onKeydown:k(p=>n(),["enter"]),class:"p-column-filter",placeholder:"Filtra per email"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),l(c,{header:"Partner"},{body:m(({data:e})=>{var n;return[F(U((n=e.partner)==null?void 0:n.name),1)]}),_:1}),l(c,{header:"Stato"},{body:m(({data:e})=>[l(d,{value:e.active?"Attivo":"Disattivo",class:$(["px-4 border-round-lg h-auto font-medium line-height-4",e.active?"active":"expired"])},null,8,["value","class"])]),_:1}),l(c,{header:"",style:{width:"4rem"}},{body:m(({data:e})=>[I(l(r,{type:"button",onClick:n=>o.showSidebar(e),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-3",icon:"pi pi-arrow-right",text:"",rounded:""},null,8,["onClick"]),[[M,"Modifica",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","totalRecords","filters","loading"])])}const H=R(j,[["render",G]]),J={setup(){const i=C(),s=V(),h=w(()=>i.getTotalUsers),o=D();return{totalUser:h,showSidebar:function(){o.setDetailType("user",!0,"Nuovo utente",null),o.updateSidebar(!0),o.setShowDetail(!0)},showMsg:function(){B(s,{message:"Questa funzionalità non è al momento disponibile",error:!0})}}},components:{UsersTable:H}},L={class:"flex justify-content-between align-items-center"},Q={class:""},W={key:0},X={key:1};function Y(i,s,h,o,b,_){const u=v("Button"),c=v("UsersTable");return y(),S("div",null,[x("div",L,[x("h1",Q,[o.totalUser==1?(y(),S("span",W," 1 Utente")):(y(),S("span",X,U(o.totalUser)+" Utenti",1))]),x("div",null,[l(u,{icon:"pi pi-upload",class:"mb-3 mr-3",label:"Importa utenti",rounded:"",outlined:"",onClick:s[0]||(s[0]=d=>o.showMsg())}),l(u,{icon:"pi pi-download",class:"mb-3 mr-3",label:"Esporta utenti",rounded:"",outlined:"",onClick:s[1]||(s[1]=d=>o.showMsg())}),l(u,{label:"Aggiungi utente",onClick:s[2]||(s[2]=d=>o.showSidebar()),class:"mb-3 bg-surface-800",rounded:"",severity:"contrast"})])]),l(c)])}const ne=R(J,[["render",Y]]);export{ne as default};
