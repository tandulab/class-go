import{o as I,y as K,t as M,z as B,f as S,a as T,q as b,A as R,g as C,B as L,C as N,s as $,_ as V,r as m,E as P,h as U,i as D,j as n,w as f,l as x,G as k,x as F,H as A,J as j,b as E,K as O,L as q,k as g}from"../index87980.js";const G={setup(){I(()=>{a.value=!0,l.value={first:0,rows:i.value.rows,sortField:null,sortOrder:null,filters:d.value},K.register("myfilter",(s,y)=>s===y),u()});const r=M(),e=B(),v=S(()=>r.responseUsers),t=S(()=>r.userRoles),p=S(()=>r.status),_=T(),i=b(),c=b(),d=b({full_name:{value:"",matchMode:"like"},email:{value:"",matchMode:"like"}}),a=b(!0),l=b(),w=b(0),o=b([{label:"My Filter",value:"myfilter"}]);function u(){a.value=!0;let s=new Map;s=R(d,s),s.set("page",l.value.page+1),s.set("per_page",l.value.rows),l.value.sortField&&(l.value.sortOrder==1?s.set("sorted_by",l.value.sortField+"_asc"):s.set("sorted_by",l.value.sortField+"_desc")),setTimeout(()=>{h(s)},Math.random()*1e3+250)}const h=async function(s){await r.fetchAllUsers(s).then(()=>{a.value=!1}).catch(y=>{a.value=!1,C(_,y)})};return{dt:i,responseUsers:v,filters:d,loading:a,totalRecords:w,lazyParams:l,matchModes:o,userRoles:t,currentUser:c,status:p,onPage:s=>{l.value=s,u()},onSort:s=>{l.value=s,u()},onFilter:()=>{l.value.page=0,l.value.filters=d.value,u()},showSidebar:function(s){e.setDetailType("user",!1,"Dettaglio utente",s.id),e.updateSidebar(!0)},loadLazyData:u,changeStatus:async function(s){a.value=!0;const y={user_id:s.id,active:s==null?void 0:s.active};await r.changeStatus(y).then(()=>{a.value=!1,$(_,{message:"Stato aggiornato correttamente",error:!1}),u()}).catch(z=>{a.value=!1,C(_,z)})},prettyUserRole:L,formatDataFromUnixTimestamps:N}},components:{}};const H={class:"user-table"};function J(r,e,v,t,p,_){const i=m("InputText"),c=m("Column"),d=m("Badge"),a=m("Button"),l=m("DataTable"),w=P("tooltip");return U(),D("div",H,[n(l,{value:t.responseUsers.users,totalRecords:t.responseUsers.total,lazy:!0,paginator:!0,rows:30,filters:t.filters,"onUpdate:filters":e[0]||(e[0]=o=>t.filters=o),ref:"dt",dataKey:"id",loading:t.loading,onPage:e[1]||(e[1]=o=>t.onPage(o)),onSort:e[2]||(e[2]=o=>t.onSort(o)),onFilter:e[3]||(e[3]=o=>t.onFilter()),filterDisplay:"row",removableSort:"",stripedRows:""},{empty:f(()=>[x(" Nessun utente trovato. ")]),default:f(()=>[n(c,{field:"full_name",header:"Nome Cognome",filterMatchMode:"contains",ref:"full_name",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:f(({filterModel:o,filterCallback:u})=>[n(i,{type:"text",modelValue:o.value,"onUpdate:modelValue":h=>o.value=h,onKeydown:k(h=>u(),["enter"]),class:"p-column-filter",placeholder:"Filtra per cognome"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),body:f(({data:o})=>[x(F(o==null?void 0:o.first_name)+" "+F(o==null?void 0:o.last_name),1)]),_:1},512),n(c,{field:"email",header:"Email",filterMatchMode:"contains",ref:"email",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:f(({filterModel:o,filterCallback:u})=>[n(i,{type:"text",modelValue:o.value,"onUpdate:modelValue":h=>o.value=h,onKeydown:k(h=>u(),["enter"]),class:"p-column-filter",placeholder:"Filtra per email"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),n(c,{header:"Partner"},{body:f(({data:o})=>{var u;return[x(F((u=o.partner)==null?void 0:u.name),1)]}),_:1}),n(c,{header:"Stato"},{body:f(({data:o})=>[n(d,{value:o.active?"Attivo":"Disattivo",class:A(["px-4 border-round-lg h-auto font-medium line-height-4",o.active?"active":"expired"])},null,8,["value","class"])]),_:1}),n(c,{header:"",style:{width:"4rem"}},{body:f(({data:o})=>[j(n(a,{type:"button",onClick:u=>t.showSidebar(o),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-3",icon:"pi pi-arrow-right",text:"",rounded:""},null,8,["onClick"]),[[w,"Modifica",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","totalRecords","filters","loading"])])}const Q=V(G,[["render",J]]),W={props:["isVisible"],setup(r){const e=b(!1),v=T(),{showLoader:t,hideLoader:p}=E(),_=M(),i=d=>{t();const a=new FormData;a.append("file",d.files[0]);const l={formData:a};_.importUser(l).then(()=>{}).catch(w=>{p(),C(v,w)})},c=function(){};return O(r,()=>{e.value=r.isVisible}),{visible:e,downloadTemplate:c,onUpload:i}}},X={class:"flex justify-content-between align-items-center w-full"},Y=g("h2",{class:"m-0"},"Importa utenti",-1),Z={class:"mt-6"},ee={class:"flex align-center justify-content-between mt-6 mb-3"};function te(r,e,v,t,p,_){const i=m("Button"),c=m("FileUpload"),d=m("Dialog");return U(),q(d,{visible:t.visible,"onUpdate:visible":e[2]||(e[2]=a=>t.visible=a),modal:"",closable:!1},{header:f(()=>[g("div",X,[Y,n(i,{rounded:"",icon:"pi pi-times",onClick:e[0]||(e[0]=a=>r.$emit("closeDialog")),text:""})])]),default:f(()=>[g("p",Z,[g("b",{class:"underline cursor-pointer",onClick:e[1]||(e[1]=a=>t.downloadTemplate())},"Scarica il template"),x(" e importa gli utenti ")]),g("div",ee,[n(c,{mode:"basic",name:"demo[]",url:"./upload.php",accept:".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel",maxFileSize:1e6,onUploader:t.onUpload,customUpload:"",auto:!0,chooseLabel:"Carica file",rounded:"",outlined:"",severity:"contrast"},null,8,["onUploader"])])]),_:1},8,["visible"])}const oe=V(W,[["render",te]]),se={setup(){const r=M(),e=T(),v=b(!1),t=S(()=>r.getTotalUsers),p=B();return{totalUser:t,isVisible:v,showSidebar:function(){p.setDetailType("user",!0,"Nuovo utente",null),p.updateSidebar(!0),p.setShowDetail(!0)},showMsg:function(){$(e,{message:"Questa funzionalità non è al momento disponibile",error:!0})},onCloseDialog:function(){v.value=!1}}},components:{UsersTable:Q,ImportUsersDialog:oe}},ae={class:"flex justify-content-between align-items-center"},ne={class:""},le={key:0},re={key:1};function ie(r,e,v,t,p,_){const i=m("Button"),c=m("UsersTable"),d=m("ImportUsersDialog");return U(),D("div",null,[g("div",ae,[g("h1",ne,[t.totalUser==1?(U(),D("span",le," 1 Utente")):(U(),D("span",re,F(t.totalUser)+" Utenti",1))]),g("div",null,[n(i,{icon:"pi pi-upload",class:"mb-3 mr-3",label:"Importa utenti",rounded:"",outlined:"",onClick:e[0]||(e[0]=a=>t.isVisible=!0)}),n(i,{icon:"pi pi-download",class:"mb-3 mr-3",label:"Esporta utenti",rounded:"",outlined:"",onClick:e[1]||(e[1]=a=>t.showMsg())}),n(i,{label:"Aggiungi utente",onClick:e[2]||(e[2]=a=>t.showSidebar()),class:"mb-3 bg-surface-800",rounded:"",severity:"contrast"})])]),n(c),n(d,{isVisible:t.isVisible,onCloseDialog:t.onCloseDialog},null,8,["isVisible","onCloseDialog"])])}const ve=V(se,[["render",ie]]);export{ve as default};
