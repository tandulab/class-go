import{o as N,q as P,s as k,c as T,a as I,p as f,_ as R,r as h,v as O,b as U,e as M,f as n,w as i,g,h as y,x,i as b,y as z}from"../index17240.js";import{u as K}from"./user17240.js";import{e as D,a as L}from"./helpers17240.js";import{f as $}from"./formatData17240.js";import{u as E}from"./location17240.js";import"./datetime17240.js";const j={setup(){N(()=>{u.value=!0,r.value={first:0,rows:v.value.rows,sortField:null,sortOrder:null,filters:d.value},P.register("myfilter",(t,_)=>t===_),a(),B()});const m=K(),s=E(),p=k(),o=T(()=>m.responseUsers),F=T(()=>m.userRoles),w=I(),v=f(),c=f(),d=f({global:{value:null,matchMode:"contains"},full_name:{value:"",matchMode:"contains"},email:{value:"",matchMode:"contains"},created_at:{value:"",matchMode:"contains"}}),u=f(!0),r=f(),V=f(0),C=f([{label:"Attivo",value:"true"},{label:"Disattivo",value:"false"}]),e=f([{label:"Utente",value:"user"},{label:"Admin",value:"admin"}]),l=f([{label:"My Filter",value:"myfilter"}]);function a(){u.value=!0;const t=new Map;t.set("global",d.value.full_name.value),t.set("email",d.value.email.value),t.set("surname",d.value.full_name.value),t.set("page",r.value.page+1),t.set("per_page",r.value.rows),r.value.sortField&&(r.value.sortOrder==1?t.set("sorted_by",r.value.sortField+"_asc"):t.set("sorted_by",r.value.sortField+"_desc")),setTimeout(()=>{A(t)},Math.random()*1e3+250)}const A=async function(t){await m.fetchAllUsers(t).then(()=>{u.value=!1}).catch(_=>{u.value=!1,D(w,_)})},B=async function(){await s.fetchAllLocations()};return{dt:v,responseUsers:o,filters:d,loading:u,totalRecords:V,lazyParams:r,matchModes:l,userRoles:F,status:C,roles:e,currentUser:c,onPage:t=>{r.value=t,a()},onSort:t=>{r.value=t,a()},onFilter:()=>{r.value.page=0,r.value.filters=d.value,a()},showSidebar:function(t){p.setDetailType("user",!1,"Dettaglio utente",t.id),p.updateSidebar(!0)},loadLazyData:a,changeStatus:async function(t){u.value=!0;const _={user_id:t.id,is_active:t==null?void 0:t.profile.is_active};await m.changeStatus(_).then(()=>{u.value=!1,L(w,{message:"Stato aggiornato correttamente",error:!1}),a()}).catch(S=>{u.value=!1,D(w,S)})},getRowClass:function(t){var _,S;return(_=t==null?void 0:t.profile)!=null&&_.cluster_role?(S=t.profile)==null?void 0:S.cluster_role:""},formatPrettyDate:$}},components:{}};const q={class:"user-table"},G={class:"flex justify-content-between align-items-center"},H={class:"p-input-icon-left w-full mr-3 py-2"},J=g("i",{class:"pi pi-search"},null,-1);function Q(m,s,p,o,F,w){const v=h("InputText"),c=h("Column"),d=h("Calendar"),u=h("InputSwitch"),r=h("Button"),V=h("DataTable"),C=O("tooltip");return U(),M("div",q,[n(V,{value:o.responseUsers.data,totalRecords:o.responseUsers.total,lazy:!0,paginator:!0,rows:30,filters:o.filters,"onUpdate:filters":s[1]||(s[1]=e=>o.filters=e),ref:"dt",dataKey:"id",loading:o.loading,onPage:s[2]||(s[2]=e=>o.onPage(e)),onSort:s[3]||(s[3]=e=>o.onSort(e)),onFilter:s[4]||(s[4]=e=>o.onFilter()),filterDisplay:"row",removableSort:"",stripedRows:"",rowClass:o.getRowClass},{header:i(()=>[g("div",G,[g("span",H,[J,n(v,{modelValue:o.filters.global.value,"onUpdate:modelValue":s[0]||(s[0]=e=>o.filters.global.value=e),placeholder:"Ricerca utente",class:"border-none w-full",onChange:o.loadLazyData},null,8,["modelValue","onChange"])])])]),empty:i(()=>[y(" Nessun utente trovato. ")]),default:i(()=>[n(c,{field:"full_name",header:"Nome Cognome",filterMatchMode:"contains",ref:"full_name",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:i(({filterModel:e,filterCallback:l})=>[n(v,{type:"text",modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,onKeydown:x(a=>l(),["enter"]),class:"p-column-filter",placeholder:"Filtra per cognome"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),body:i(({data:e})=>{var l,a;return[y(b((l=e==null?void 0:e.profile)==null?void 0:l.name)+" "+b((a=e==null?void 0:e.profile)==null?void 0:a.surname),1)]}),_:1},512),n(c,{field:"email",header:"Email",filterMatchMode:"contains",ref:"email",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:i(({filterModel:e,filterCallback:l})=>[n(v,{type:"text",modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,onKeydown:x(a=>l(),["enter"]),class:"p-column-filter",placeholder:"Filtra per email"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),n(c,{header:"Sede",filterMatchMode:"contains",ref:"bank",field:"bannk",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:i(({data:e})=>{var l,a;return[y(b(((a=(l=e.profile)==null?void 0:l.bank)==null?void 0:a.name)||"-"),1)]}),_:1},512),n(c,{header:"N.ro richieste"},{body:i(({data:e})=>{var l;return[y(b(((l=e==null?void 0:e.profile)==null?void 0:l.requests_nr)||"-"),1)]}),_:1}),n(c,{header:"Data creazione",field:"created_at",filterMatchMode:"contains",ref:"created_at",sortable:!0,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:i(({filterModel:e,filterCallback:l})=>[n(d,{inputId:"dateformat",modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,dateFormat:"dd/mm/yy",onKeydown:x(a=>l(),["enter"]),manualInput:!1,placeholder:"Filtra per...",onDateSelect:a=>l(),selectionMode:"range"},null,8,["modelValue","onUpdate:modelValue","onKeydown","onDateSelect"])]),body:i(({data:e})=>[y(b(o.formatPrettyDate(e==null?void 0:e.created_at)),1)]),_:1},512),n(c,{header:"Stato",filterMatchMode:"contains"},{body:i(({data:e})=>[n(u,{modelValue:e.profile.is_active,"onUpdate:modelValue":l=>e.profile.is_active=l,onChange:l=>o.changeStatus(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),n(c,{header:"",style:{width:"4rem"}},{body:i(({data:e})=>[z(n(r,{type:"button",onClick:l=>o.showSidebar(e),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-3",icon:"pi pi-arrow-right",text:"",rounded:""},null,8,["onClick"]),[[C,"Edit",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","totalRecords","filters","loading","rowClass"])])}const W=R(j,[["render",Q]]),X={setup(){const m=K(),s=T(()=>m.getTotalUsers),p=k();return{totalUser:s,showSidebar:function(){p.setDetailType("user",!0,"Nuovo utente",null),p.updateSidebar(!0),p.setShowDetail(!0)}}},components:{UsersTable:W}},Y={class:"flex justify-content-between align-items-center"},Z={class:""},ee={key:0},te={key:1};function oe(m,s,p,o,F,w){const v=h("Button"),c=h("UsersTable");return U(),M("div",null,[g("div",Y,[g("h1",Z,[o.totalUser==1?(U(),M("span",ee," 1 Utente")):(U(),M("span",te,b(o.totalUser)+" Utenti",1))]),n(v,{label:"Aggiungi utente",onClick:s[0]||(s[0]=d=>o.showSidebar()),class:"mb-3",rounded:"",outlined:""})]),n(c)])}const ve=R(X,[["render",oe]]);export{ve as default};
