import{o as I,y as K,t as M,z as B,f as D,a as T,q as g,A as L,g as x,B as R,C as N,s as $,_ as V,r as m,E as P,h as w,i as y,j as n,w as f,l as C,G as k,x as F,k as h,v as A,H as j,J as E,K as O,b as q,L as G,M as H}from"../index41704.js";const J={setup(){I(()=>{a.value=!0,l.value={first:0,rows:i.value.rows,sortField:null,sortOrder:null,filters:d.value},K.register("myfilter",(s,S)=>s===S),u()});const r=M(),e=B(),v=D(()=>r.responseUsers),t=D(()=>r.userRoles),p=D(()=>r.status),_=T(),i=g(),c=g(),d=g({full_name:{value:"",matchMode:"like"},email:{value:"",matchMode:"like"}}),a=g(!0),l=g(),U=g(0),o=g([{label:"My Filter",value:"myfilter"}]);function u(){a.value=!0;let s=new Map;s=L(d,s),s.set("page",l.value.page+1),s.set("per_page",l.value.rows),l.value.sortField&&(l.value.sortOrder==1?s.set("sorted_by",l.value.sortField+"_asc"):s.set("sorted_by",l.value.sortField+"_desc")),setTimeout(()=>{b(s)},Math.random()*1e3+250)}const b=async function(s){await r.fetchAllUsers(s).then(()=>{a.value=!1}).catch(S=>{a.value=!1,x(_,S)})};return{dt:i,responseUsers:v,filters:d,loading:a,totalRecords:U,lazyParams:l,matchModes:o,userRoles:t,currentUser:c,status:p,onPage:s=>{l.value=s,u()},onSort:s=>{l.value=s,u()},onFilter:()=>{l.value.page=0,l.value.filters=d.value,u()},showSidebar:function(s){e.setDetailType("user",!1,"Dettaglio utente",s.id),e.updateSidebar(!0)},loadLazyData:u,changeStatus:async function(s){a.value=!0;const S={user_id:s.id,active:s==null?void 0:s.active};await r.changeStatus(S).then(()=>{a.value=!1,$(_,{message:"Stato aggiornato correttamente",error:!1}),u()}).catch(z=>{a.value=!1,x(_,z)})},prettyUserRole:R,formatDataFromUnixTimestamps:N}},components:{}};const Q={class:"user-table"},W={class:"no-bullets"};function X(r,e,v,t,p,_){const i=m("InputText"),c=m("Column"),d=m("Badge"),a=m("Button"),l=m("DataTable"),U=P("tooltip");return w(),y("div",Q,[n(l,{value:t.responseUsers.users,totalRecords:t.responseUsers.total,lazy:!0,paginator:!0,rows:30,filters:t.filters,"onUpdate:filters":e[0]||(e[0]=o=>t.filters=o),ref:"dt",dataKey:"id",loading:t.loading,onPage:e[1]||(e[1]=o=>t.onPage(o)),onSort:e[2]||(e[2]=o=>t.onSort(o)),onFilter:e[3]||(e[3]=o=>t.onFilter()),filterDisplay:"row",removableSort:"",stripedRows:""},{empty:f(()=>[C(" Nessun utente trovato. ")]),default:f(()=>[n(c,{field:"full_name",header:"Nome Cognome",filterMatchMode:"contains",ref:"full_name",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:f(({filterModel:o,filterCallback:u})=>[n(i,{type:"text",modelValue:o.value,"onUpdate:modelValue":b=>o.value=b,onKeydown:k(b=>u(),["enter"]),class:"p-column-filter",placeholder:"Filtra per cognome"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),body:f(({data:o})=>[C(F(o==null?void 0:o.first_name)+" "+F(o==null?void 0:o.last_name),1)]),_:1},512),n(c,{field:"email",header:"Email",filterMatchMode:"contains",ref:"email",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:f(({filterModel:o,filterCallback:u})=>[n(i,{type:"text",modelValue:o.value,"onUpdate:modelValue":b=>o.value=b,onKeydown:k(b=>u(),["enter"]),class:"p-column-filter",placeholder:"Filtra per email"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),n(c,{header:"Partners"},{body:f(({data:o})=>[h("ul",W,[(w(!0),y(A,null,j(o.partners,(u,b)=>(w(),y("li",{key:b},F(u.name),1))),128))])]),_:1}),n(c,{header:"Stato"},{body:f(({data:o})=>[n(d,{value:o.active?"Attivo":"Disattivo",class:E(["px-4 border-round-lg h-auto font-medium line-height-4",o.active?"active":"expired"])},null,8,["value","class"])]),_:1}),n(c,{header:"",style:{width:"4rem"}},{body:f(({data:o})=>[O(n(a,{type:"button",onClick:u=>t.showSidebar(o),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-3",icon:"pi pi-arrow-right",text:"",rounded:""},null,8,["onClick"]),[[U,"Modifica",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","totalRecords","filters","loading"])])}const Y=V(J,[["render",X]]),Z={props:["isVisible"],setup(r){const e=g(!1),v=T(),{showLoader:t,hideLoader:p}=q(),_=M(),i=d=>{t();const a=new FormData;a.append("file",d.files[0]);const l={formData:a};_.importUser(l).then(()=>{}).catch(U=>{p(),x(v,U)})},c=function(){};return G(r,()=>{e.value=r.isVisible}),{visible:e,downloadTemplate:c,onUpload:i}}},ee={class:"flex justify-content-between align-items-center w-full"},te=h("h2",{class:"m-0"},"Importa utenti",-1),oe={class:"mt-6"},se={class:"flex align-center justify-content-between mt-6 mb-3"};function ae(r,e,v,t,p,_){const i=m("Button"),c=m("FileUpload"),d=m("Dialog");return w(),H(d,{visible:t.visible,"onUpdate:visible":e[2]||(e[2]=a=>t.visible=a),modal:"",closable:!1},{header:f(()=>[h("div",ee,[te,n(i,{rounded:"",icon:"pi pi-times",onClick:e[0]||(e[0]=a=>r.$emit("closeDialog")),text:""})])]),default:f(()=>[h("p",oe,[h("b",{class:"underline cursor-pointer",onClick:e[1]||(e[1]=a=>t.downloadTemplate())},"Scarica il template"),C(" e importa gli utenti ")]),h("div",se,[n(c,{mode:"basic",name:"demo[]",url:"./upload.php",accept:".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel",maxFileSize:1e6,onUploader:t.onUpload,customUpload:"",auto:!0,chooseLabel:"Carica file",rounded:"",outlined:"",severity:"contrast"},null,8,["onUploader"])])]),_:1},8,["visible"])}const ne=V(Z,[["render",ae]]),le={setup(){const r=M(),e=T(),v=g(!1),t=D(()=>r.getTotalUsers),p=B();return{totalUser:t,isVisible:v,showSidebar:function(){p.setDetailType("user",!0,"Nuovo utente",null),p.updateSidebar(!0),p.setShowDetail(!0)},showMsg:function(){$(e,{message:"Questa funzionalità non è al momento disponibile",error:!0})},onCloseDialog:function(){v.value=!1}}},components:{UsersTable:Y,ImportUsersDialog:ne}},re={class:"flex justify-content-between align-items-center"},ie={class:""},ce={key:0},ue={key:1};function de(r,e,v,t,p,_){const i=m("Button"),c=m("UsersTable"),d=m("ImportUsersDialog");return w(),y("div",null,[h("div",re,[h("h1",ie,[t.totalUser==1?(w(),y("span",ce," 1 Utente")):(w(),y("span",ue,F(t.totalUser)+" Utenti",1))]),h("div",null,[n(i,{icon:"pi pi-upload",class:"mb-3 mr-3",label:"Importa utenti",rounded:"",outlined:"",onClick:e[0]||(e[0]=a=>t.isVisible=!0)}),n(i,{icon:"pi pi-download",class:"mb-3 mr-3",label:"Esporta utenti",rounded:"",outlined:"",onClick:e[1]||(e[1]=a=>t.showMsg())}),n(i,{label:"Aggiungi utente",onClick:e[2]||(e[2]=a=>t.showSidebar()),class:"mb-3 bg-surface-800",rounded:"",severity:"contrast"})])]),n(c),n(d,{isVisible:t.isVisible,onCloseDialog:t.onCloseDialog},null,8,["isVisible","onCloseDialog"])])}const ge=V(le,[["render",de]]);export{ge as default};
