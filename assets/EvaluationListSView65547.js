import{o as D,W as E,z as T,f as V,a as A,q as c,A as C,g as K,X as B,_ as z,r as f,E as O,h as S,i as M,j as s,w as u,l as h,G as F,x as y,k as g,H as $,J as P,D as q,u as N,L as R,V as I}from"../index65547.js";const j={setup(){D(()=>{d.value=!0,n.value={first:0,page:0,rows:p.value.rows,sortField:null,sortOrder:null,filters:a.value},t()});const m=E(),l=T(),v=V(()=>m.responseEvaluations),o=V(()=>m.evaluationTypes),w=A(),p=c(),_=c(),a=c({cf:{value:"",matchMode:"eq"},piva:{value:"",matchMode:"eq"},created_at:{value:"",matchMode:"eq"},denominazione:{value:"",matchMode:"eq"}}),d=c(!0),n=c(),b=c(0),x=c([{label:"Attivo",value:"true"},{label:"Disattivo",value:"false"}]),e=c([{label:"Utente",value:"evaluation"},{label:"Admin",value:"admin"}]),i=c([{label:"My Filter",value:"myfilter"}]);function t(){d.value=!0;let r=new Map;r=C(a,r),r.set("page",n.value.page+1),r.set("per_page",n.value.rows),n.value.sortField&&(n.value.sortOrder==1?r.set("sorted_by",n.value.sortField+"_asc"):r.set("sorted_by",n.value.sortField+"_desc")),setTimeout(()=>{k(r)},Math.random()*1e3+250)}const k=async function(r){await m.fetchAllEvaluations(r).then(()=>{d.value=!1}).catch(U=>{d.value=!1,K(w,U)})};return{dt:p,responseEvaluations:v,filters:a,loading:d,totalRecords:b,lazyParams:n,matchModes:i,status:x,roles:e,currentEvaluation:_,evaluationTypes:o,onPage:r=>{n.value=r,t()},onSort:r=>{n.value=r,t()},onFilter:()=>{n.value.page=0,n.value.filters=a.value,t()},showSidebar:function(r){l.setDetailType("evaluationS",!1,"Dettaglio valutazione",null,!1,!1,r),l.updateSidebar(!0)},loadLazyData:t,formatDataAndHourFromUnixTimestamps:B}},components:{}};const H=g("div",{class:"flex justify-content-center w-full"},"Semaforo",-1);function L(m,l,v,o,w,p){const _=f("Calendar"),a=f("Column"),d=f("InputText"),n=f("Button"),b=f("DataTable"),x=O("tooltip");return S(),M("div",null,[s(b,{value:o.responseEvaluations.cqs_evaluations,totalRecords:o.responseEvaluations.total,lazy:!0,paginator:!0,rows:30,filters:o.filters,"onUpdate:filters":l[0]||(l[0]=e=>o.filters=e),ref:"dt",dataKey:"id",loading:o.loading,onPage:l[1]||(l[1]=e=>o.onPage(e)),onSort:l[2]||(l[2]=e=>o.onSort(e)),onFilter:l[3]||(l[3]=e=>o.onFilter()),filterDisplay:"row",removableSort:"",stripedRows:""},{empty:u(()=>[h(" Nessuna richiesta trovata. ")]),default:u(()=>[s(a,{header:"Data e ora",field:"created_at",filterMatchMode:"contains",ref:"created_at",sortable:!0,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:u(({filterModel:e,filterCallback:i})=>[s(_,{inputId:"dateformat",modelValue:e.value,"onUpdate:modelValue":t=>e.value=t,dateFormat:"dd/mm/yy",onKeydown:F(t=>i(),["enter"]),manualInput:!1,placeholder:"Filtra per data",onDateSelect:t=>i()},null,8,["modelValue","onUpdate:modelValue","onKeydown","onDateSelect"])]),body:u(({data:e})=>[h(y(o.formatDataAndHourFromUnixTimestamps(e==null?void 0:e.created_at)),1)]),_:1},512),s(a,{header:"Codice fiscale",ref:"cf",field:"cf",filterMatchMode:"contains",sortable:!0,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:u(({filterModel:e,filterCallback:i})=>[s(d,{type:"text",modelValue:e.value,"onUpdate:modelValue":t=>e.value=t,onKeydown:F(t=>i(),["enter"]),class:"p-column-filter",placeholder:"Filtra per codice fiscale"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),s(a,{header:"PIVA",ref:"piva",field:"piva",filterMatchMode:"contains",sortable:!0,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:u(({filterModel:e,filterCallback:i})=>[s(d,{type:"text",modelValue:e.value,"onUpdate:modelValue":t=>e.value=t,onKeydown:F(t=>i(),["enter"]),class:"p-column-filter",placeholder:"Filtra per partita iva"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),s(a,{field:"denominazione",header:"Denominazione",filterMatchMode:"contains",ref:"denominazione",sortable:!0,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:u(({filterModel:e,filterCallback:i})=>[s(d,{type:"text",modelValue:e.value,"onUpdate:modelValue":t=>e.value=t,onKeydown:F(t=>i(),["enter"]),class:"p-column-filter",placeholder:"Filtra per denominazione"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),body:u(({data:e})=>[h(y(e==null?void 0:e.denominazione),1)]),_:1},512),s(a,{field:"created_by",header:"Richiedente"},{body:u(({data:e})=>{var i,t;return[h(y((i=e==null?void 0:e.created_by)==null?void 0:i.first_name)+" "+y((t=e==null?void 0:e.created_by)==null?void 0:t.last_name),1)]}),_:1}),s(a,{field:"partner",header:"Partner"},{body:u(({data:e})=>[h(" - ")]),_:1}),s(a,{header:"",class:"text-center"},{header:u(()=>[H]),body:u(({data:e})=>[g("i",{class:$(["pi pi-circle-fill block text-center",{"text-red-600":e.semaforo=="R","text-yellow-50":e.semaforo=="G","text-green-300":e.semaforo=="V"}])},null,2)]),_:1}),s(a,{header:"Valutazione",ref:"valutazioni"},{body:u(({data:e})=>[h(y(e.valutazione),1)]),_:1},512),s(a,{header:"",style:{width:"4rem"}},{body:u(({data:e})=>[P(s(n,{type:"button",onClick:i=>o.showSidebar(e),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-3",icon:"pi pi-arrow-right",text:"",rounded:""},null,8,["onClick"]),[[x,"Modifica",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","totalRecords","filters","loading"])])}const G=z(j,[["render",L]]),J={setup(){D(()=>{const a=q.now(),d=a.startOf("week").toFormat("dd"),n=a.endOf("week").toFormat("dd"),b=a.toFormat("MMMM yyyy");o.value=`${d}/${n} ${b}`});const m=N(),l=E(),v=T(),o=c(),w=V(()=>l.getTotalEvaluations),p=V(()=>m.isUserAdmin);return{totalEvaluation:w,weekDate:o,isAdmin:p,sidebarStore:v,showSidebar:function(){v.setDetailType("newEvaluationS",!0,"Nuova valutazione",null),v.updateSidebar(!0),v.setShowDetail(!0)}}},components:{EvaluationsSTable:G}},W={class:"flex justify-content-between align-items-center"},X={class:""},Y={key:0},Q={key:1};function Z(m,l,v,o,w,p){const _=f("Button"),a=f("EvaluationsSTable");return S(),M("div",null,[g("div",W,[g("h1",X,[o.totalEvaluation==1?(S(),M("span",Y," 1 Valutazione")):(S(),M("span",Q,y(o.totalEvaluation)+" Valutazioni",1))]),o.isAdmin?I("",!0):(S(),R(_,{key:0,label:"Aggiungi valutazione",class:"mb-3",rounded:"",outlined:"",onClick:l[0]||(l[0]=d=>o.showSidebar())}))]),s(a)])}const ne=z(J,[["render",Z]]);export{ne as default};
