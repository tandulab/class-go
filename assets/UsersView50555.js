import{o as N,l as z,m as K,c as y,a as A,k as _,_ as O,r as m,n as I,b as F,e as V,f as n,w as r,g as U,h as w,p as D,t as b,q as P,s as j,v as E,x as $}from"../index50555.js";import{u as L}from"./user50555.js";import{f as G,b as H,e as B,p as J,c as Q,a as W}from"./helpers50555.js";import{u as X}from"./location50555.js";const Y={setup(){N(()=>{d.value=!0,i.value={first:0,rows:g.value.rows,sortField:null,sortOrder:null,filters:c.value},z.register("myfilter",(o,v)=>o===v),e(),l()});const f=L(),a=X(),p=K(),t=y(()=>f.responseUsers),C=y(()=>f.userRoles),M=y(()=>a.getFormattedLocations),h=y(()=>f.status),u=A(),g=_(),T=_(),c=_({global:{value:null,matchMode:"like"},full_name:{value:"",matchMode:"like"},email:{value:"",matchMode:"eq"},created_at:{value:"",matchMode:"like"},role:{value:"",matchMode:"eq"},location:{value:"",matchMode:"eq"},enabled:{value:"",matchMode:"eq"}}),d=_(!0),i=_(),x=_(0),k=_([{label:"My Filter",value:"myfilter"}]);function e(){var S,R;d.value=!0;let o=new Map;if((S=c.value.location)!=null&&S.value){var v=Object.keys(c.value.location.value)[0];let q=G(v,M.value);o.set("location_id_eq",q)}(R=c.value.global)!=null&&R.value&&o.set("full_name_like",c.value.global.value),o=H(c,o),o.delete("location_eq"),o.delete("global"),o.set("page",i.value.page+1),o.set("per_page",i.value.rows),i.value.sortField&&(i.value.sortOrder==1?o.set("sorted_by",i.value.sortField+"_asc"):o.set("sorted_by",i.value.sortField+"_desc")),setTimeout(()=>{s(o)},Math.random()*1e3+250)}const s=async function(o){await f.fetchAllUsers(o).then(()=>{d.value=!1}).catch(v=>{d.value=!1,B(u,v)})},l=async function(){await a.fetchAllLocations()};return{dt:g,responseUsers:t,filters:c,loading:d,totalRecords:x,lazyParams:i,matchModes:k,userRoles:C,currentUser:T,locations:M,status:h,onPage:o=>{i.value=o,e()},onSort:o=>{i.value=o,e()},onFilter:()=>{i.value.page=0,i.value.filters=c.value,e()},showSidebar:function(o){p.setDetailType("user",!1,"Dettaglio utente",o.id),p.updateSidebar(!0)},loadLazyData:e,changeStatus:async function(o){d.value=!0;const v={user_id:o.id,enabled:o==null?void 0:o.enabled};await f.changeStatus(v).then(()=>{d.value=!1,W(u,{message:"Stato aggiornato correttamente",error:!1}),e()}).catch(S=>{d.value=!1,B(u,S)})},getRowClass:function(o){return o!=null&&o.cluster?o.cluster:""},prettyUserRole:J,formatDataFromUnixTimestamps:Q}},components:{}};const Z={class:"user-table"},ee={class:"flex justify-content-between align-items-center"},oe={class:"p-input-icon-left w-full mr-3 py-2"},te=U("i",{class:"pi pi-search"},null,-1);function le(f,a,p,t,C,M){const h=m("InputText"),u=m("Column"),g=m("TreeSelect"),T=m("Calendar"),c=m("Dropdown"),d=m("Badge"),i=m("Button"),x=m("DataTable"),k=I("tooltip");return F(),V("div",Z,[n(x,{value:t.responseUsers.users,totalRecords:t.responseUsers.total,lazy:!0,paginator:!0,rows:30,filters:t.filters,"onUpdate:filters":a[1]||(a[1]=e=>t.filters=e),ref:"dt",dataKey:"id",loading:t.loading,onPage:a[2]||(a[2]=e=>t.onPage(e)),onSort:a[3]||(a[3]=e=>t.onSort(e)),onFilter:a[4]||(a[4]=e=>t.onFilter()),filterDisplay:"row",removableSort:"",stripedRows:"",rowClass:t.getRowClass},{header:r(()=>[U("div",ee,[U("span",oe,[te,n(h,{modelValue:t.filters.global.value,"onUpdate:modelValue":a[0]||(a[0]=e=>t.filters.global.value=e),placeholder:"Ricerca utente",class:"border-none w-full",onChange:t.loadLazyData},null,8,["modelValue","onChange"])])])]),empty:r(()=>[w(" Nessun utente trovato. ")]),default:r(()=>[n(u,{field:"full_name",header:"Nome Cognome",filterMatchMode:"contains",ref:"full_name",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:r(({filterModel:e,filterCallback:s})=>[n(h,{type:"text",modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,onKeydown:D(l=>s(),["enter"]),class:"p-column-filter",placeholder:"Filtra per cognome"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),body:r(({data:e})=>[w(b(e==null?void 0:e.first_name)+" "+b(e==null?void 0:e.last_name),1)]),_:1},512),n(u,{field:"email",header:"Email",filterMatchMode:"contains",ref:"email",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:r(({filterModel:e,filterCallback:s})=>[n(h,{type:"text",modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,onKeydown:D(l=>s(),["enter"]),class:"p-column-filter",placeholder:"Filtra per email"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),n(u,{header:"Sede",filterMatchMode:"contains",ref:"location",field:"location",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:r(({filterModel:e,filterCallback:s})=>[n(g,{modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,options:t.locations,class:"w-full",selectionMode:"single",onChange:l=>s(),placeholder:"Filtra per sede"},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),body:r(({data:e})=>{var s;return[w(b(((s=e.location)==null?void 0:s.name)||"-"),1)]}),_:1},512),n(u,{header:"Data creazione",field:"created_at",filterMatchMode:"contains",ref:"created_at",sortable:!0,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:r(({filterModel:e,filterCallback:s})=>[n(T,{inputId:"dateformat",modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,dateFormat:"dd/mm/yy",onKeydown:D(l=>s(),["enter"]),manualInput:!1,placeholder:"Filtra per data",onDateSelect:l=>s()},null,8,["modelValue","onUpdate:modelValue","onKeydown","onDateSelect"])]),body:r(({data:e})=>[w(b(t.formatDataFromUnixTimestamps(e==null?void 0:e.created_at)),1)]),_:1},512),n(u,{header:"Ruolo",ref:"role",field:"role",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1,sortable:""},{filter:r(({filterModel:e,filterCallback:s})=>[n(c,{modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,options:t.userRoles,optionLabel:"name",optionValue:"value",onChange:l=>s(),placeholder:"Filtra per ruolo"},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),body:r(({data:e})=>[e&&e.role?(F(),P(d,{key:0,value:t.prettyUserRole(e.role),class:j(["px-4 border-round-lg h-auto font-medium line-height-4",e.role])},null,8,["value","class"])):E("",!0)]),_:1},512),n(u,{header:"Stato",filterMatchMode:"contains",ref:"enabled",field:"enabled",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:r(({filterModel:e,filterCallback:s})=>[n(c,{modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,options:t.status,optionLabel:"name",optionValue:"value",onChange:l=>s(),placeholder:"Filtra per stato"},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),body:r(({data:e})=>[w(b(e.enabled?"Attivo":"Disattivo"),1)]),_:1},512),n(u,{header:"",style:{width:"4rem"}},{body:r(({data:e})=>[$(n(i,{type:"button",onClick:s=>t.showSidebar(e),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-3",icon:"pi pi-arrow-right",text:"",rounded:""},null,8,["onClick"]),[[k,"Edit",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","totalRecords","filters","loading","rowClass"])])}const ae=O(Y,[["render",le]]),se={setup(){const f=L(),a=y(()=>f.getTotalUsers),p=K();return{totalUser:a,showSidebar:function(){p.setDetailType("user",!0,"Nuovo utente",null),p.updateSidebar(!0),p.setShowDetail(!0)}}},components:{UsersTable:ae}},ne={class:"flex justify-content-between align-items-center"},re={class:""},ie={key:0},ue={key:1};function ce(f,a,p,t,C,M){const h=m("Button"),u=m("UsersTable");return F(),V("div",null,[U("div",ne,[U("h1",re,[t.totalUser==1?(F(),V("span",ie," 1 Utente")):(F(),V("span",ue,b(t.totalUser)+" Utenti",1))]),n(h,{label:"Aggiungi utente",onClick:a[0]||(a[0]=g=>t.showSidebar()),class:"mb-3",rounded:"",outlined:""})]),n(u)])}const ye=O(se,[["render",ce]]);export{ye as default};
