import{o as N,X as R,z as B,Y as ee,t as te,u as O,f as m,a as ae,q as c,b as oe,g as ne,Z as le,A as se,_ as K,r as S,E as re,h as x,i as T,k as h,x as v,J as ie,L as ue,j as s,w as r,l as M,G as q,K as ce,M as de,D as ve}from"../index58801.js";const fe={setup(){N(()=>{E.value=!0,u.value={first:0,page:0,rows:l.value.rows,sortField:null,sortOrder:null,filters:A.value},C(),Q(),$()});const f=R(),n=B(),_=ee(),a=te(),w=O(),g=m(()=>f.responseEvaluations),d=m(()=>f.evaluationTypes),i=m(()=>_.allPartners),p=m(()=>a.allUsers),y=m(()=>w.isUserAdmin),z=m(()=>w.isUserMaster),D=t=>t.first_name+" "+t.last_name,e=ae(),l=c(),o=c(),F=c(),V=c(),{showLoader:P,hideLoader:k}=oe(),A=c({cf:{value:"",matchMode:"eq"},piva:{value:"",matchMode:"eq"},created_at:{value:"",matchMode:"eq"},partner_id:{value:"",matchMode:"eq"},created_by_id:{value:"",matchMode:"eq"}}),E=c(!0),u=c(),j=c(0),I=c([{label:"Attivo",value:"true"},{label:"Disattivo",value:"false"}]),G=c([{label:"Utente",value:"evaluation"},{label:"Admin",value:"admin"}]),H=c([{label:"My Filter",value:"myfilter"}]),L=function(t){return t=se(A,t),t.set("page",u.value.page+1),t.set("per_page",u.value.rows),u.value.sortField&&(u.value.sortOrder==1?t.set("sorted_by",u.value.sortField+"_asc"):t.set("sorted_by",u.value.sortField+"_desc")),t};function C(){E.value=!0;let t=new Map;L(t),setTimeout(()=>{Y(t)},Math.random()*1e3+250)}const Y=async function(t){await f.fetchAllEvaluations(t).then(()=>{E.value=!1}).catch(b=>{E.value=!1,ne(e,b)})},J=t=>{u.value=t,C()},W=t=>{u.value=t,C()},X=()=>{u.value.page=0,u.value.filters=A.value,C()},Z=function(t){n.setDetailType("evaluationS",!1,"Dettaglio valutazione",null,!1,!1,t),n.updateSidebar(!0)},Q=async function(){await _.fetchAllPartners()},$=async function(){let t=new Map;t.set("page",1),t.set("per_page",1e11),await a.fetchAllUsers(t)};return{dt:l,responseEvaluations:g,filters:A,loading:E,totalRecords:j,lazyParams:u,matchModes:H,status:I,roles:G,currentEvaluation:o,evaluationTypes:d,partners:F,allPartner:i,allUsers:p,users:V,isAdmin:y,isMaster:z,onPage:J,onSort:W,onFilter:X,showSidebar:Z,loadLazyData:C,searchPartner:t=>{const b=t.query.toLowerCase();F.value=i.value.filter(U=>U.name.toLowerCase().startsWith(b))},searchUser:t=>{const b=t.query.toLowerCase();V.value=p.value.filter(U=>(U.first_name.toLowerCase()+" "+U.last_name.toLowerCase()).includes(b)||U.email.toLowerCase().includes(b))},downloadReport:async function(){P();let t=new Map;L(t),await f.getEvaluationsReport(t).then(()=>{k()}).catch(()=>{k()})},showSidebarNewEvaluation:function(){n.setDetailType("newEvaluationS",!0,"Nuova valutazione",null),n.updateSidebar(!0),n.setShowDetail(!0)},createdByFullName:D,formatDataAndHourFromUnixTimestamps:le}},components:{}};const me={class:"flex justify-content-between align-items-center"},pe={class:""},he={key:0},_e={key:1},we=h("div",{class:"flex justify-content-center w-full"},"Semaforo",-1);function ye(f,n,_,a,w,g){const d=S("Button"),i=S("Column"),p=S("InputText"),y=S("AutoComplete"),z=S("DataTable"),D=re("tooltip");return x(),T("div",null,[h("div",me,[h("h1",pe,[a.responseEvaluations.total==1?(x(),T("span",he," 1 Valutazione")):(x(),T("span",_e,v(a.responseEvaluations.total)+" Valutazioni",1))]),h("div",null,[a.isAdmin?(x(),ie(d,{key:0,icon:"pi pi-download",class:"mb-3 mr-3",label:"Esporta report",rounded:"",outlined:"",onClick:n[0]||(n[0]=e=>a.downloadReport())})):ue("",!0),s(d,{label:"Aggiungi valutazione",class:"mb-3",rounded:"",outlined:"",onClick:n[1]||(n[1]=e=>a.showSidebarNewEvaluation()),severity:"contrast"})])]),s(z,{value:a.responseEvaluations.cqs_evaluations,totalRecords:a.responseEvaluations.total,lazy:!0,paginator:!0,rows:30,filters:a.filters,"onUpdate:filters":n[2]||(n[2]=e=>a.filters=e),ref:"dt",dataKey:"id",loading:a.loading,onPage:n[3]||(n[3]=e=>a.onPage(e)),onSort:n[4]||(n[4]=e=>a.onSort(e)),onFilter:n[5]||(n[5]=e=>a.onFilter()),filterDisplay:"row",removableSort:"",stripedRows:""},{empty:r(()=>[M(" Nessuna richiesta trovata. ")]),default:r(()=>[s(i,{header:"Data e ora",field:"created_at",ref:"created_at"},{body:r(({data:e})=>[M(v(a.formatDataAndHourFromUnixTimestamps(e==null?void 0:e.created_at)),1)]),_:1},512),s(i,{header:"Codice fiscale",ref:"cf",field:"cf",filterMatchMode:"contains",sortable:!0,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:r(({filterModel:e,filterCallback:l})=>[s(p,{type:"text",modelValue:e.value,"onUpdate:modelValue":o=>e.value=o,onKeydown:q(o=>l(),["enter"]),class:"p-column-filter",placeholder:"Filtra per codice fiscale"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),s(i,{header:"PIVA",ref:"piva",field:"piva",filterMatchMode:"contains",sortable:!0,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:r(({filterModel:e,filterCallback:l})=>[s(p,{type:"text",modelValue:e.value,"onUpdate:modelValue":o=>e.value=o,onKeydown:q(o=>l(),["enter"]),class:"p-column-filter",placeholder:"Filtra per partita iva"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),s(i,{field:"denominazione",header:"Denominazione",ref:"denominazione"},{body:r(({data:e})=>[M(v(e==null?void 0:e.denominazione),1)]),_:1},512),s(i,{field:"created_by_id",header:"Richiedente",filterMatchMode:"contains",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:r(({filterModel:e,filterCallback:l})=>[s(y,{modelValue:e.value,"onUpdate:modelValue":[o=>e.value=o,l],suggestions:a.users,onComplete:a.searchUser,optionLabel:a.createdByFullName,optionValue:"id",class:"w-full capitalize",placeholder:"Filtra per richiedente"},{option:r(o=>{var F,V;return[h("div",null,v((F=o==null?void 0:o.option)==null?void 0:F.first_name)+" "+v((V=o==null?void 0:o.option)==null?void 0:V.last_name),1)]}),_:2},1032,["modelValue","onUpdate:modelValue","suggestions","onComplete","optionLabel"])]),body:r(({data:e})=>{var l,o;return[M(v((l=e==null?void 0:e.created_by)==null?void 0:l.first_name)+" "+v((o=e==null?void 0:e.created_by)==null?void 0:o.last_name),1)]}),_:1}),s(i,{field:"partner_id",ref:"partner_id",header:"Partner",filterMatchMode:"contains",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:r(({filterModel:e,filterCallback:l})=>[s(y,{modelValue:e.value,"onUpdate:modelValue":[o=>e.value=o,l],suggestions:a.partners,onComplete:a.searchPartner,optionLabel:"name",optionValue:"id",class:"w-full capitalize",placeholder:"Filtra per partner"},{option:r(o=>[h("div",null,v(o.option.name),1)]),_:2},1032,["modelValue","onUpdate:modelValue","suggestions","onComplete"])]),body:r(({data:e})=>{var l;return[M(v((l=e==null?void 0:e.partner)==null?void 0:l.name),1)]}),_:1},512),s(i,{header:"",class:"text-center"},{header:r(()=>[we]),body:r(({data:e})=>[h("i",{class:ce(["pi pi-circle-fill block text-center",{"text-red-600":e.semaforo=="R","text-yellow-50":e.semaforo=="G","text-green-300":e.semaforo=="V"}])},null,2)]),_:1}),s(i,{header:"Valutazione",ref:"valutazioni"},{body:r(({data:e})=>[M(v(e.valutazione),1)]),_:1},512),s(i,{header:"",style:{width:"4rem"}},{body:r(({data:e})=>[de(s(d,{type:"button",onClick:l=>a.showSidebar(e),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-3",icon:"pi pi-arrow-right",text:"",rounded:""},null,8,["onClick"]),[[D,"Modifica",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","totalRecords","filters","loading"])])}const be=K(fe,[["render",ye]]),Me={setup(){N(()=>{const d=ve.now(),i=d.startOf("week").toFormat("dd"),p=d.endOf("week").toFormat("dd"),y=d.toFormat("MMMM yyyy");a.value=`${i}/${p} ${y}`});const f=O(),n=R(),_=B(),a=c(),w=m(()=>n.getTotalEvaluations),g=m(()=>f.isUserAdmin);return{totalEvaluation:w,weekDate:a,isAdmin:g,sidebarStore:_}},components:{EvaluationsSTable:be}};function Se(f,n,_,a,w,g){const d=S("EvaluationsSTable");return x(),T("div",null,[s(d)])}const Ue=K(Me,[["render",Se]]);export{Ue as default};
