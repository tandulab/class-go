import{K as k,L as W,M as E,N as O,O as q,o as G,q as g,a as Q,P as R,Q as z,b as H,f as N,R as J,s as b,g as x,I as X,S as Y,_ as Z,r as h,h as w,i as $,k as l,j as p,w as T,T as B,U as C}from"../index80269.js";class _{static async getLocations(){return(await k("/locations")).data.locations}static async getLocationsDetail(e){return(await k(`/locations/${e}`)).data.location}static async addLocation(e){return(await W("/locations",e)).data.location}static async deleteLocation(e){return(await E(`/locations/${e}`)).data}static async updateLocation(e){return(await O(`/locations/${e.location.id}`,e.location)).data.location}}const ee=q({id:"location",state:()=>({location:{},locations:[],formatted_locations:[]}),getters:{getLocations:t=>t.locations,getFormattedLocations:t=>t.formatted_locations,getCurrentLocation:t=>t.location},actions:{async fetchAllLocations(){await _.getLocations().then(t=>{function e(i){function o(a,d){const m={key:d.toString(),label:a.name,id:a.id,children:[]};return a.children&&a.children.length>0&&(m.children=a.children.map((r,c)=>o(r,`${d}-${c}`))),m}return i.map((a,d)=>o(a,d))}this.formatted_locations=e(t)})},async getLocationsDetail(t){await _.getLocationsDetail(t).then(e=>this.location=e)},async addLocation(t){await _.addLocation(t).then(e=>this.location=e)},async updateLocation(t){await _.updateLocation(t).then(e=>this.location=e)},async deleteLocation(t){await _.deleteLocation(t).then(e=>this.location=e)}}}),te={setup(){G(()=>{y()});const t=g({}),e=ee(),i=g({}),o=g(void 0),a=Q(),{handleSubmit:d,resetForm:m}=R();z("name",v);const{showLoader:r,hideLoader:c}=H();function v(){return!t.value.name||t.value.name==null?"Il nome Ã¨ obbligatorio":!0}const f=N(()=>e.getFormattedLocations),s=N(()=>e.getCurrentLocation),y=async function(){await e.fetchAllLocations().then(()=>{F()})},F=()=>{for(let n of f.value)S(n);i.value={...i.value}},S=n=>{if(n.children&&n.children.length){i.value[n.key]=!0;for(let u of n.children)S(u)}},I=function(){t.value.id=s.value.id,t.value.name=s.value.name,s.value.parent_id&&(t.value.branch_selected=Y(s.value.parent_id,f.value))},D=async function(n){r(),e.getLocationsDetail(n).then(()=>{I(),c()}).catch(u=>{x(a,u),c()})},j=n=>{D(n.id)},L=function(){m(),t.value.id&&delete t.value.id,t.value.branch_selected&&(t.value.branch_selected={})},A=d(()=>{let n={name:t.value.name};if(t.value.branch_selected){var u=Object.keys(t.value.branch_selected)[0],K=J(u,f.value);K&&(n.parent_id=K+"")}const V={location:n};t.value.id?P(V):M(V)}),M=async function(n){await e.addLocation(n).then(()=>{c(),b(a,{message:"Sede creata correttamente.",title:""}),y(),L()})},U=async function(){r(),e.deleteLocation(t.value.id+"").then(()=>{c(),b(a,{message:"Sede eliminata con successo",title:""}),y(),L()}).catch(n=>{c(),x(a,n)})},P=async function(n){r(),n.location.id=t.value.id,e.updateLocation(n).then(()=>{b(a,{message:"Sede aggiornata correttamente",title:""}),y(),c(),L()}).catch(u=>{c(),x(a,u)})};return{tmp_branch:t,expandedKeys:i,selectedKey:o,locations:f,onSubmit:A,onNodeSelect:j,deleteLocation:U}},components:{InputTextWithValidation:X}},oe=l("div",{class:"flex justify-content-between align-items-center"},[l("h1",null,"Nuova sede")],-1),ne={class:"flex"},ae={class:"col-6 ml-0 pl-0"},se={class:"formgrid grid mt-3"},ce={class:"field col-12"},ie={class:"field col-12 flex flex-column"},le=l("label",{for:"role"},"Sede",-1),de={class:"flex justify-content-end mt-3"},re={class:"col-6"};function ue(t,e,i,o,a,d){const m=h("InputTextWithValidation"),r=h("TreeSelect"),c=h("Button"),v=h("Card"),f=h("Tree");return w(),$("div",null,[oe,l("div",ne,[l("div",ae,[p(v,null,{content:T(()=>[l("form",{onSubmit:e[3]||(e[3]=(...s)=>o.onSubmit&&o.onSubmit(...s)),class:"flex flex-column"},[l("div",se,[l("div",ce,[p(m,{name:"name",label:"Nome*",modelValue:o.tmp_branch.name,class:"w-full","onUpdate:modelValue":e[0]||(e[0]=s=>o.tmp_branch.name=s)},null,8,["modelValue"])]),l("div",ie,[le,p(r,{modelValue:o.tmp_branch.branch_selected,"onUpdate:modelValue":e[1]||(e[1]=s=>o.tmp_branch.branch_selected=s),options:o.locations,placeholder:"",class:"w-full",selectionMode:"single"},null,8,["modelValue","options"])])]),l("div",de,[o.tmp_branch.id?(w(),B(c,{key:0,label:"Elimina sede",rounded:"",text:"",class:"mr-1",onClick:e[2]||(e[2]=s=>o.deleteLocation())})):C("",!0),p(c,{type:"submit",label:o.tmp_branch.id?"Modifica sede":"Aggiungi sede",rounded:"",outlined:""},null,8,["label"])])],32)]),_:1})]),l("div",re,[o.locations?(w(),B(v,{key:0},{content:T(()=>[p(f,{value:o.locations,class:"w-full",expandedKeys:o.expandedKeys,"onUpdate:expandedKeys":e[4]||(e[4]=s=>o.expandedKeys=s),selectionKeys:o.selectedKey,"onUpdate:selectionKeys":e[5]||(e[5]=s=>o.selectedKey=s),onNodeSelect:o.onNodeSelect,selectionMode:"single"},null,8,["value","expandedKeys","selectionKeys","onNodeSelect"])]),_:1})):C("",!0)])])])}const fe=Z(te,[["render",ue]]);export{fe as default};
