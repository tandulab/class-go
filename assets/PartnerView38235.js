import{d as C,Z as x,a0 as F,a as G,o as K,q as h,f as _,g as f,O as Z,r as v,G as $,h as D,i as S,j as o,w as i,l as b,x as g,N as z,K as H,M as J,s as V,k as Q}from"../index38235.js";const W=C({__name:"PartnerTable",setup(T){const l=x(),d=F(),s=G();K(async()=>{await w(),P()});const c=h([]),y=h([]),r=h(!1),k=_(()=>l.allPartners),B=_(()=>l.getTotalPartners),U=_(()=>d.submitDialog);let p=null;const w=async()=>{r.value=!0;try{await l.fetchAllPartners(),E(),Object.assign(c.value,k.value),N()}catch(e){f(s,e)}finally{r.value=!1}},E=()=>{c.value.splice(0,c.value.length)},P=()=>{let e={name:"",id:"-1"};c.value.unshift(e),y.value.push(e)},N=()=>{c.value.sort(function(e,a){return e.created_at<a.created_at?1:e.created_at>a.created_at?-1:0})},A=async e=>{let{newData:a,index:n}=e;if(n===0)if(a.name.length>0)await R(a);else return;else await j(a);await w(),P()},R=async e=>{const a={partner:{name:e.name,code:e.code,cf:e.cf}};r.value=!0;try{await l.addPartner(a),V(s,{message:"Partner aggiunto correttamente",title:""})}catch(n){f(s,n)}finally{r.value=!1}},j=async e=>{const a={partner:{name:e.name,code:e.code,cf:e.cf},id:e.id};r.value=!0;try{await l.updatePartner(a),V(s,{message:"Partner aggiornato correttamente",title:""})}catch(n){f(s,n)}finally{r.value=!1}},L=async()=>{r.value=!0;try{await l.removePartner(p),V(s,{message:"Partner rimosso correttamente",title:""})}catch(e){f(s,e)}finally{r.value=!1,await w(),P(),d.setBtnSubmit(!1),p=null}};Z(U,()=>{p&&L()});const M=(e,a)=>{p=a.data;let n="Sei sicuro di voler eliminare questo partner?";d.setDialog("Elimina partner","Conferma","Annulla",n),d.setDynamicDialogVisibility(!0)};return(e,a)=>{const n=v("InputText"),m=v("Column"),q=v("Button"),I=v("DataTable"),O=$("tooltip");return D(),S("div",null,[o(I,{loading:r.value,value:c.value,"total-records":B.value,editMode:"row","editing-rows":y.value,"onUpdate:editingRows":a[0]||(a[0]=t=>y.value=t),onRowEditSave:A},{default:i(()=>[o(m,{field:"name",header:"Nome"},{body:i(({data:t})=>[b(g(t.name),1)]),editor:i(({data:t})=>[o(n,{modelValue:t.name,"onUpdate:modelValue":u=>t.name=u},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(m,{field:"code",header:"Codice"},{body:i(({data:t})=>[b(g(t.code),1)]),editor:i(({data:t})=>[o(n,{modelValue:t.code,"onUpdate:modelValue":u=>t.code=u},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(m,{field:"cf",header:"Codice Fiscale"},{body:i(({data:t})=>[b(g(t.cf),1)]),editor:i(({data:t})=>[o(n,{modelValue:t.cf,"onUpdate:modelValue":u=>t.cf=u},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(m,{rowEditor:!0,bodyStyle:"text-align:end"}),o(m,null,{body:i(t=>[t.index!=0?z((D(),H(q,{key:0,onClick:u=>M(u,t),type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-400",icon:"pi pi-trash"},null,8,["onClick"])),[[O,"Elimina",void 0,{top:!0}]]):J("",!0)]),_:1})]),_:1},8,["loading","value","total-records","editing-rows"])])}}}),Y=C({__name:"PartnerView",setup(T){const l=x(),d=_(()=>l.getTotalPartners);return(s,c)=>(D(),S("div",null,[Q("h1",null,g(d.value)+" Partner",1),o(W)]))}});export{Y as default};
