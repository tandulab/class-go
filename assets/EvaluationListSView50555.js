import{o as k,m as x,c as V,a as C,k as c,_ as z,r as f,n as A,b as S,e as F,f as r,w as d,g as b,h as w,p as T,t as _,s as O,x as B,u as K,q as N,v as R}from"../index50555.js";import{u as U}from"./evaluation50555.js";import{b as $,e as I,g as P,D as q}from"./helpers50555.js";const L={setup(){k(()=>{l.value=!0,n.value={first:0,page:0,rows:h.value.rows,sortField:null,sortOrder:null,filters:i.value},s()});const m=U(),a=x(),v=V(()=>m.responseEvaluations),t=V(()=>m.evaluationTypes),g=C(),h=c(),p=c(),i=c({global:{value:null,matchMode:"like"},full_name:{value:"",matchMode:"like"},created_at:{value:"",matchMode:"like"},cf_piva:{value:"",matchMode:"eq"},ragioneSociale:{value:"",matchMode:"eq"},valutazioni:{value:"",matchMode:"eq"}}),l=c(!0),n=c(),y=c(0),D=c([{label:"Attivo",value:"true"},{label:"Disattivo",value:"false"}]),E=c([{label:"Utente",value:"evaluation"},{label:"Admin",value:"admin"}]),e=c([{label:"My Filter",value:"myfilter"}]);function s(){var M;l.value=!0;let o=new Map;(M=i.value.global)!=null&&M.value&&o.set("piva_like",i.value.global.value),o=$(i,o),o.delete("global"),o.set("page",n.value.page+1),o.set("per_page",n.value.rows),n.value.sortField&&(n.value.sortOrder==1?o.set("sorted_by",n.value.sortField+"_asc"):o.set("sorted_by",n.value.sortField+"_desc")),setTimeout(()=>{u(o)},Math.random()*1e3+250)}const u=async function(o){await m.fetchAllEvaluations(o).then(()=>{l.value=!1}).catch(M=>{l.value=!1,I(g,M)})};return{dt:h,responseEvaluations:v,filters:i,loading:l,totalRecords:y,lazyParams:n,matchModes:e,status:D,roles:E,currentEvaluation:p,evaluationTypes:t,onPage:o=>{n.value=o,s()},onSort:o=>{n.value=o,s()},onFilter:()=>{n.value.page=0,n.value.filters=i.value,s()},showSidebar:function(o){a.setDetailType("evaluationS",!1,"Dettaglio valutazione",o.id,!1,!1),a.updateSidebar(!0)},loadLazyData:s,formatDataAndHourFromUnixTimestamps:P}},components:{}};const j={class:"flex justify-content-between align-items-center"},H={class:"p-input-icon-left w-full mr-3 py-2"},Y=b("i",{class:"pi pi-search"},null,-1);function G(m,a,v,t,g,h){const p=f("InputText"),i=f("Calendar"),l=f("Column"),n=f("Dropdown"),y=f("Button"),D=f("DataTable"),E=A("tooltip");return S(),F("div",null,[r(D,{value:t.responseEvaluations.users,totalRecords:t.responseEvaluations.total,lazy:!0,paginator:!0,rows:30,filters:t.filters,"onUpdate:filters":a[1]||(a[1]=e=>t.filters=e),ref:"dt",dataKey:"id",loading:t.loading,onPage:a[2]||(a[2]=e=>t.onPage(e)),onSort:a[3]||(a[3]=e=>t.onSort(e)),onFilter:a[4]||(a[4]=e=>t.onFilter()),filterDisplay:"row",removableSort:"",stripedRows:""},{header:d(()=>[b("div",j,[b("span",H,[Y,r(p,{modelValue:t.filters.global.value,"onUpdate:modelValue":a[0]||(a[0]=e=>t.filters.global.value=e),placeholder:"Ricerca per partita iva",class:"border-none w-full"},null,8,["modelValue"])])])]),empty:d(()=>[w(" Nessuna richiesta trovata. ")]),default:d(()=>[r(l,{header:"Data e ora",field:"created_at",filterMatchMode:"contains",ref:"created_at",sortable:!0,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:d(({filterModel:e,filterCallback:s})=>[r(i,{inputId:"dateformat",modelValue:e.value,"onUpdate:modelValue":u=>e.value=u,dateFormat:"dd/mm/yy",onKeydown:T(u=>s(),["enter"]),manualInput:!1,placeholder:"Filtra per data",onDateSelect:u=>s()},null,8,["modelValue","onUpdate:modelValue","onKeydown","onDateSelect"])]),body:d(({data:e})=>[w(_(t.formatDataAndHourFromUnixTimestamps(e==null?void 0:e.created_at)),1)]),_:1},512),r(l,{header:"P.Iva",filterMatchMode:"contains",ref:"cf_piva",field:"cf_piva",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:d(({filterModel:e,filterCallback:s})=>[r(p,{type:"text",modelValue:e.value,"onUpdate:modelValue":u=>e.value=u,onKeydown:T(u=>s(),["enter"]),class:"p-column-filter",placeholder:"Filtra per partita Iva"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),r(l,{field:"ragioneSociale",header:"Ragione Sociale",filterMatchMode:"contains",ref:"ragioneSociale",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:d(({data:e})=>[w(_(e.ragione_sociale&&e.ragione_sociale.length>30?e.ragione_sociale.substring(0,30)+"...":e.ragione_sociale),1)]),_:1},512),r(l,{field:"full_name",header:"Utente",filterMatchMode:"contains",ref:"full_name",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:d(({filterModel:e,filterCallback:s})=>[r(p,{type:"text",modelValue:e.value,"onUpdate:modelValue":u=>e.value=u,onKeydown:T(u=>s(),["enter"]),class:"p-column-filter",placeholder:"Filtra per cognome"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),body:d(({data:e})=>[w(_(e==null?void 0:e.first_name)+" "+_(e==null?void 0:e.last_name),1)]),_:1},512),r(l,{header:"Valutazione",ref:"valutazioni",field:"valutazioni",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1,sortable:""},{filter:d(({filterModel:e,filterCallback:s})=>[r(n,{modelValue:e.value,"onUpdate:modelValue":u=>e.value=u,options:t.evaluationTypes,optionLabel:"name",optionValue:"value",onChange:u=>s(),placeholder:"Filtra per ruolo"},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),body:d(({data:e})=>[b("i",{class:O(["pi pi-circle-fill mr-2",{"text-red-600":e.valutazioni=="Non solvibile","text-green-300":e.valutazioni=="Solvibile"}])},null,2),w(" "+_(e.valutazioni),1)]),_:1},512),r(l,{header:"Report",filterMatchMode:"contains"},{body:d(({data:e})=>[w(_(e.pdf_url?e.pdf_approfondito_url?"2 allegati":"1 allegato":"0 allegati"),1)]),_:1}),r(l,{header:"",style:{width:"4rem"}},{body:d(({data:e})=>[B(r(y,{type:"button",onClick:s=>t.showSidebar(e),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-3",icon:"pi pi-arrow-right",text:"",rounded:""},null,8,["onClick"]),[[E,"Edit",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","totalRecords","filters","loading"])])}const J=z(L,[["render",G]]),Q={setup(){k(()=>{const i=q.now(),l=i.startOf("week").toFormat("dd"),n=i.endOf("week").toFormat("dd"),y=i.toFormat("MMMM yyyy");t.value=`${l}/${n} ${y}`});const m=K(),a=U(),v=x(),t=c(),g=V(()=>a.getTotalEvaluations),h=V(()=>m.isUserAdmin);return{totalEvaluation:g,weekDate:t,isAdmin:h,sidebarStore:v,showSidebar:function(){v.setDetailType("newEvaluationS",!0,"Nuova valutazione",null),v.updateSidebar(!0),v.setShowDetail(!0)}}},components:{EvaluationsSTable:J}},W={class:"flex justify-content-between align-items-center"},X={class:""},Z={key:0},ee={key:1};function te(m,a,v,t,g,h){const p=f("Button"),i=f("EvaluationsSTable");return S(),F("div",null,[b("div",W,[b("h1",X,[t.totalEvaluation==1?(S(),F("span",Z," 1 Valutazione")):(S(),F("span",ee,_(t.totalEvaluation)+" Valutazioni",1))]),t.isAdmin?R("",!0):(S(),N(p,{key:0,label:"Aggiungi valutazione",class:"mb-3",rounded:"",outlined:"",onClick:a[0]||(a[0]=l=>t.showSidebar())}))]),r(i)])}const ue=z(Q,[["render",te]]);export{ue as default};
