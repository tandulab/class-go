import{o as x,V as k,z,f as V,a as C,q as c,A,g as O,W as B,_ as U,r as f,E as K,h as S,i as F,j as r,w as d,k as b,l as w,G as T,x as _,H as N,J as R,D as q,u as I,T as P,U as $}from"../index57677.js";const L={setup(){x(()=>{l.value=!0,n.value={first:0,page:0,rows:h.value.rows,sortField:null,sortOrder:null,filters:i.value},s()});const m=k(),o=z(),v=V(()=>m.responseEvaluations),a=V(()=>m.evaluationTypes),g=C(),h=c(),p=c(),i=c({global:{value:null,matchMode:"eq"},full_name:{value:"",matchMode:"like"},created_at:{value:"",matchMode:"like"},cf_piva:{value:"",matchMode:"eq"},ragioneSociale:{value:"",matchMode:"eq"},valutazioni:{value:"",matchMode:"eq"}}),l=c(!0),n=c(),y=c(0),D=c([{label:"Attivo",value:"true"},{label:"Disattivo",value:"false"}]),E=c([{label:"Utente",value:"evaluation"},{label:"Admin",value:"admin"}]),e=c([{label:"My Filter",value:"myfilter"}]);function s(){var M;l.value=!0;let t=new Map;(M=i.value.global)!=null&&M.value&&t.set("cf_piva_like",i.value.global.value),t=A(i,t),t.delete("global_eq"),t.set("page",n.value.page+1),t.set("per_page",n.value.rows),n.value.sortField&&(n.value.sortOrder==1?t.set("sorted_by",n.value.sortField+"_asc"):t.set("sorted_by",n.value.sortField+"_desc")),setTimeout(()=>{u(t)},Math.random()*1e3+250)}const u=async function(t){await m.fetchAllEvaluations(t).then(()=>{l.value=!1}).catch(M=>{l.value=!1,O(g,M)})};return{dt:h,responseEvaluations:v,filters:i,loading:l,totalRecords:y,lazyParams:n,matchModes:e,status:D,roles:E,currentEvaluation:p,evaluationTypes:a,onPage:t=>{n.value=t,s()},onSort:t=>{n.value=t,s()},onFilter:()=>{n.value.page=0,n.value.filters=i.value,s()},showSidebar:function(t){o.setDetailType("evaluationS",!1,"Dettaglio valutazione",t.id,!1,!1),o.updateSidebar(!0)},loadLazyData:s,formatDataAndHourFromUnixTimestamps:B}},components:{}};const j={class:"flex justify-content-between align-items-center"},H={class:"p-input-icon-left w-full mr-3 py-2"},G=b("i",{class:"pi pi-search"},null,-1);function J(m,o,v,a,g,h){const p=f("InputText"),i=f("Calendar"),l=f("Column"),n=f("Dropdown"),y=f("Button"),D=f("DataTable"),E=K("tooltip");return S(),F("div",null,[r(D,{value:a.responseEvaluations.users,totalRecords:a.responseEvaluations.total,lazy:!0,paginator:!0,rows:30,filters:a.filters,"onUpdate:filters":o[1]||(o[1]=e=>a.filters=e),ref:"dt",dataKey:"id",loading:a.loading,onPage:o[2]||(o[2]=e=>a.onPage(e)),onSort:o[3]||(o[3]=e=>a.onSort(e)),onFilter:o[4]||(o[4]=e=>a.onFilter()),filterDisplay:"row",removableSort:"",stripedRows:""},{header:d(()=>[b("div",j,[b("span",H,[G,r(p,{modelValue:a.filters.global.value,"onUpdate:modelValue":o[0]||(o[0]=e=>a.filters.global.value=e),placeholder:"Ricerca per partita iva",class:"border-none w-full",onChange:a.loadLazyData},null,8,["modelValue","onChange"])])])]),empty:d(()=>[w(" Nessuna richiesta trovata. ")]),default:d(()=>[r(l,{header:"Data e ora",field:"created_at",filterMatchMode:"contains",ref:"created_at",sortable:!0,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:d(({filterModel:e,filterCallback:s})=>[r(i,{inputId:"dateformat",modelValue:e.value,"onUpdate:modelValue":u=>e.value=u,dateFormat:"dd/mm/yy",onKeydown:T(u=>s(),["enter"]),manualInput:!1,placeholder:"Filtra per data",onDateSelect:u=>s()},null,8,["modelValue","onUpdate:modelValue","onKeydown","onDateSelect"])]),body:d(({data:e})=>[w(_(a.formatDataAndHourFromUnixTimestamps(e==null?void 0:e.created_at)),1)]),_:1},512),r(l,{header:"P.Iva",filterMatchMode:"contains",ref:"cf_piva",field:"cf_piva",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:d(({filterModel:e,filterCallback:s})=>[r(p,{type:"text",modelValue:e.value,"onUpdate:modelValue":u=>e.value=u,onKeydown:T(u=>s(),["enter"]),class:"p-column-filter",placeholder:"Filtra per partita Iva"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),r(l,{field:"ragioneSociale",header:"Ragione Sociale",filterMatchMode:"contains",ref:"ragioneSociale",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:d(({data:e})=>[w(_(e.ragione_sociale&&e.ragione_sociale.length>30?e.ragione_sociale.substring(0,30)+"...":e.ragione_sociale),1)]),_:1},512),r(l,{field:"full_name",header:"Utente",filterMatchMode:"contains",ref:"full_name",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:d(({filterModel:e,filterCallback:s})=>[r(p,{type:"text",modelValue:e.value,"onUpdate:modelValue":u=>e.value=u,onKeydown:T(u=>s(),["enter"]),class:"p-column-filter",placeholder:"Filtra per cognome"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),body:d(({data:e})=>[w(_(e==null?void 0:e.first_name)+" "+_(e==null?void 0:e.last_name),1)]),_:1},512),r(l,{header:"Valutazione",ref:"valutazioni",field:"valutazioni",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1,sortable:""},{filter:d(({filterModel:e,filterCallback:s})=>[r(n,{modelValue:e.value,"onUpdate:modelValue":u=>e.value=u,options:a.evaluationTypes,optionLabel:"name",optionValue:"value",onChange:u=>s(),placeholder:"Filtra per ruolo"},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),body:d(({data:e})=>[b("i",{class:N(["pi pi-circle-fill mr-2",{"text-red-600":e.valutazioni=="Non solvibile","text-green-300":e.valutazioni=="Solvibile"}])},null,2),w(" "+_(e.valutazioni),1)]),_:1},512),r(l,{header:"Report",filterMatchMode:"contains"},{body:d(({data:e})=>[w(_(e.pdf_url?e.pdf_approfondito_url?"2 allegati":"1 allegato":"0 allegati"),1)]),_:1}),r(l,{header:"",style:{width:"4rem"}},{body:d(({data:e})=>[R(r(y,{type:"button",onClick:s=>a.showSidebar(e),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-3",icon:"pi pi-arrow-right",text:"",rounded:""},null,8,["onClick"]),[[E,"Edit",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","totalRecords","filters","loading"])])}const W=U(L,[["render",J]]),Y={setup(){x(()=>{const i=q.now(),l=i.startOf("week").toFormat("dd"),n=i.endOf("week").toFormat("dd"),y=i.toFormat("MMMM yyyy");a.value=`${l}/${n} ${y}`});const m=I(),o=k(),v=z(),a=c(),g=V(()=>o.getTotalEvaluations),h=V(()=>m.isUserAdmin);return{totalEvaluation:g,weekDate:a,isAdmin:h,sidebarStore:v,showSidebar:function(){v.setDetailType("newEvaluationS",!0,"Nuova valutazione",null),v.updateSidebar(!0),v.setShowDetail(!0)}}},components:{EvaluationsSTable:W}},Q={class:"flex justify-content-between align-items-center"},X={class:""},Z={key:0},ee={key:1};function ae(m,o,v,a,g,h){const p=f("Button"),i=f("EvaluationsSTable");return S(),F("div",null,[b("div",Q,[b("h1",X,[a.totalEvaluation==1?(S(),F("span",Z," 1 Valutazione")):(S(),F("span",ee,_(a.totalEvaluation)+" Valutazioni",1))]),a.isAdmin?$("",!0):(S(),P(p,{key:0,label:"Aggiungi valutazione",class:"mb-3",rounded:"",outlined:"",onClick:o[0]||(o[0]=l=>a.showSidebar())}))]),r(i)])}const re=U(Y,[["render",ae]]);export{re as default};
