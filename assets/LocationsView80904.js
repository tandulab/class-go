import{o as W,q as b,z as D,a as E,O,P as q,b as z,f as w,B as P,s as y,g as x,I as Q,Q as G,_ as H,r as m,h as g,i as J,k as l,j as f,w as k,K as N,M as B}from"../index80904.js";const R={setup(){W(()=>{v()});const n=b({}),e=D(),r=b({}),o=b(void 0),c=E(),{handleSubmit:L,resetForm:h}=O();q("name",_);const{showLoader:u,hideLoader:s}=z();function _(){return!n.value.name||n.value.name==null?"Il nome Ã¨ obbligatorio":!0}const d=w(()=>e.getFormattedLocations),a=w(()=>e.getCurrentLocation),v=async function(){await e.fetchAllLocations().then(()=>{T()})},T=()=>{for(let t of d.value)S(t);r.value={...r.value}},S=t=>{if(t.children&&t.children.length){r.value[t.key]=!0;for(let i of t.children)S(i)}},C=function(){n.value.id=a.value.id,n.value.name=a.value.name,a.value.parent_id&&(n.value.branch_selected=G(a.value.parent_id,d.value))},F=async function(t){u(),e.getLocationsDetail(t).then(()=>{C(),s()}).catch(i=>{x(c,i),s()})},I=t=>{F(t.id)},p=function(){h(),n.value.id&&delete n.value.id,n.value.branch_selected&&(n.value.branch_selected={})},M=L(()=>{let t={name:n.value.name};if(n.value.branch_selected){var i=Object.keys(n.value.branch_selected)[0],K=P(i,d.value);K&&(t.parent_id=K+"")}const V={location:t};n.value.id?U(V):j(V)}),j=async function(t){await e.addLocation(t).then(()=>{s(),y(c,{message:"Sede creata correttamente.",title:""}),v(),p()})},A=async function(){u(),e.deleteLocation(n.value.id+"").then(()=>{s(),y(c,{message:"Sede eliminata con successo",title:""}),v(),p()}).catch(t=>{s(),x(c,t)})},U=async function(t){u(),t.location.id=n.value.id,e.updateLocation(t).then(()=>{y(c,{message:"Sede aggiornata correttamente",title:""}),v(),s(),p()}).catch(i=>{s(),x(c,i)})};return{tmp_branch:n,expandedKeys:r,selectedKey:o,locations:d,onSubmit:M,onNodeSelect:I,deleteLocation:A}},components:{InputTextWithValidation:Q}},X=l("div",{class:"flex justify-content-between align-items-center"},[l("h1",null,"Nuova sede")],-1),Y={class:"flex"},Z={class:"col-6 ml-0 pl-0"},$={class:"formgrid grid mt-3"},ee={class:"field col-12"},te={class:"field col-12 flex flex-column"},oe=l("label",{for:"role"},"Sede",-1),ne={class:"flex justify-content-end mt-3"},ae={class:"col-6"};function le(n,e,r,o,c,L){const h=m("InputTextWithValidation"),u=m("TreeSelect"),s=m("Button"),_=m("Card"),d=m("Tree");return g(),J("div",null,[X,l("div",Y,[l("div",Z,[f(_,null,{content:k(()=>[l("form",{onSubmit:e[3]||(e[3]=(...a)=>o.onSubmit&&o.onSubmit(...a)),class:"flex flex-column"},[l("div",$,[l("div",ee,[f(h,{name:"name",label:"Nome*",modelValue:o.tmp_branch.name,class:"w-full","onUpdate:modelValue":e[0]||(e[0]=a=>o.tmp_branch.name=a)},null,8,["modelValue"])]),l("div",te,[oe,f(u,{modelValue:o.tmp_branch.branch_selected,"onUpdate:modelValue":e[1]||(e[1]=a=>o.tmp_branch.branch_selected=a),options:o.locations,placeholder:"",class:"w-full",selectionMode:"single"},null,8,["modelValue","options"])])]),l("div",ne,[o.tmp_branch.id?(g(),N(s,{key:0,label:"Elimina sede",rounded:"",text:"",class:"mr-1",onClick:e[2]||(e[2]=a=>o.deleteLocation())})):B("",!0),f(s,{type:"submit",label:o.tmp_branch.id?"Modifica sede":"Aggiungi sede",rounded:"",outlined:""},null,8,["label"])])],32)]),_:1})]),l("div",ae,[o.locations?(g(),N(_,{key:0},{content:k(()=>[f(d,{value:o.locations,class:"w-full",expandedKeys:o.expandedKeys,"onUpdate:expandedKeys":e[4]||(e[4]=a=>o.expandedKeys=a),selectionKeys:o.selectedKey,"onUpdate:selectionKeys":e[5]||(e[5]=a=>o.selectedKey=a),onNodeSelect:o.onNodeSelect,selectionMode:"single"},null,8,["value","expandedKeys","selectionKeys","onNodeSelect"])]),_:1})):B("",!0)])])])}const ce=H(R,[["render",le]]);export{ce as default};
