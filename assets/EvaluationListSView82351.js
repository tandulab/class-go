import{o as k,W as q,z as L,X as J,t as X,f as M,a as $,q as c,b as Q,g as Z,Y as ee,A as te,_ as R,r as g,E as oe,h as T,i as D,k as S,x as d,j as n,w as i,l as b,G as A,H as ae,J as ne,D as le,u as se}from"../index82351.js";const re={setup(){k(()=>{m.value=!0,u.value={first:0,page:0,rows:_.value.rows,sortField:null,sortOrder:null,filters:h.value},x(),W(),Y()});const f=q(),l=L(),p=J(),o=X(),F=M(()=>f.responseEvaluations),V=M(()=>f.evaluationTypes),v=M(()=>p.allPartners),s=M(()=>o.allUsers),w=$(),_=c(),E=c(),U=c(),e=c(),{showLoader:r,hideLoader:a}=Q(),h=c({cf:{value:"",matchMode:"eq"},piva:{value:"",matchMode:"eq"},created_at:{value:"",matchMode:"eq"},partner_id_eq:{value:"",matchMode:"eq"},created_by:{value:"",matchMode:"eq"}}),m=c(!0),u=c(),O=c(0),K=c([{label:"Attivo",value:"true"},{label:"Disattivo",value:"false"}]),B=c([{label:"Utente",value:"evaluation"},{label:"Admin",value:"admin"}]),N=c([{label:"My Filter",value:"myfilter"}]),z=function(t){return t=te(h,t),t.set("page",u.value.page+1),t.set("per_page",u.value.rows),u.value.sortField&&(u.value.sortOrder==1?t.set("sorted_by",u.value.sortField+"_asc"):t.set("sorted_by",u.value.sortField+"_desc")),t};function x(){m.value=!0;let t=new Map;z(t);debugger;setTimeout(()=>{P(t)},Math.random()*1e3+250)}const P=async function(t){await f.fetchAllEvaluations(t).then(()=>{m.value=!1}).catch(y=>{m.value=!1,Z(w,y)})},j=t=>{u.value=t,x()},H=t=>{u.value=t,x()},I=()=>{u.value.page=0,u.value.filters=h.value,x()},G=function(t){l.setDetailType("evaluationS",!1,"Dettaglio valutazione",null,!1,!1,t),l.updateSidebar(!0)},W=async function(){await p.fetchAllPartners()},Y=async function(){let t=new Map;t.set("page",1),t.set("per_page",1e11),await o.fetchAllUsers(t)};return{dt:_,responseEvaluations:F,filters:h,loading:m,totalRecords:O,lazyParams:u,matchModes:N,status:K,roles:B,currentEvaluation:E,evaluationTypes:V,partners:U,allPartner:v,allUsers:s,users:e,onPage:j,onSort:H,onFilter:I,showSidebar:G,loadLazyData:x,searchPartner:t=>{const y=t.query.toLowerCase();U.value=v.value.filter(C=>C.name.toLowerCase().startsWith(y))},searchUser:t=>{const y=t.query.toLowerCase();e.value=s.value.filter(C=>(C.first_name.toLowerCase()+" "+C.last_name.toLowerCase()).includes(y)||C.email.toLowerCase().includes(y))},downloadReport:async function(){r();let t=new Map;z(t),await f.getEvaluationsReport(t).then(()=>{a()}).catch(()=>{a()})},formatDataAndHourFromUnixTimestamps:ee}},components:{}};const ie={class:"flex justify-content-between align-items-center"},ue={class:""},ce={key:0},de={key:1},pe=S("div",{class:"flex justify-content-center w-full"},"Semaforo",-1);function fe(f,l,p,o,F,V){const v=g("Button"),s=g("Column"),w=g("InputText"),_=g("AutoComplete"),E=g("DataTable"),U=oe("tooltip");return T(),D("div",null,[S("div",ie,[S("h1",ue,[o.responseEvaluations.total==1?(T(),D("span",ce," 1 Valutazione")):(T(),D("span",de,d(o.responseEvaluations.total)+" Valutazioni",1))]),n(v,{icon:"pi pi-download",class:"mb-3 mr-3",label:"Esporta report",rounded:"",outlined:"",onClick:l[0]||(l[0]=e=>o.downloadReport())})]),n(E,{value:o.responseEvaluations.cqs_evaluations,totalRecords:o.responseEvaluations.total,lazy:!0,paginator:!0,rows:30,filters:o.filters,"onUpdate:filters":l[1]||(l[1]=e=>o.filters=e),ref:"dt",dataKey:"id",loading:o.loading,onPage:l[2]||(l[2]=e=>o.onPage(e)),onSort:l[3]||(l[3]=e=>o.onSort(e)),onFilter:l[4]||(l[4]=e=>o.onFilter()),filterDisplay:"row",removableSort:"",stripedRows:""},{empty:i(()=>[b(" Nessuna richiesta trovata. ")]),default:i(()=>[n(s,{header:"Data e ora",field:"created_at",ref:"created_at"},{body:i(({data:e})=>[b(d(o.formatDataAndHourFromUnixTimestamps(e==null?void 0:e.created_at)),1)]),_:1},512),n(s,{header:"Codice fiscale",ref:"cf",field:"cf",filterMatchMode:"contains",sortable:!0,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:i(({filterModel:e,filterCallback:r})=>[n(w,{type:"text",modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,onKeydown:A(a=>r(),["enter"]),class:"p-column-filter",placeholder:"Filtra per codice fiscale"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),n(s,{header:"PIVA",ref:"piva",field:"piva",filterMatchMode:"contains",sortable:!0,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:i(({filterModel:e,filterCallback:r})=>[n(w,{type:"text",modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,onKeydown:A(a=>r(),["enter"]),class:"p-column-filter",placeholder:"Filtra per partita iva"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),n(s,{field:"denominazione",header:"Denominazione",ref:"denominazione"},{body:i(({data:e})=>[b(d(e==null?void 0:e.denominazione),1)]),_:1},512),n(s,{field:"created_by",header:"Richiedente",filterMatchMode:"contains",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:i(({filterModel:e,filterCallback:r})=>[n(_,{modelValue:e.value,"onUpdate:modelValue":[a=>e.value=a,r],suggestions:o.users,onComplete:o.searchUser,optionLabel:"name",optionValue:"id",class:"w-full capitalize",placeholder:"Filtra per richiedente"},{option:i(a=>{var h,m;return[S("div",null,d((h=a==null?void 0:a.option)==null?void 0:h.first_name)+" "+d((m=a==null?void 0:a.option)==null?void 0:m.last_name),1)]}),_:2},1032,["modelValue","onUpdate:modelValue","suggestions","onComplete"])]),body:i(({data:e})=>{var r,a;return[b(d((r=e==null?void 0:e.created_by)==null?void 0:r.first_name)+" "+d((a=e==null?void 0:e.created_by)==null?void 0:a.last_name),1)]}),_:1}),n(s,{field:"partner_id_eq",ref:"partner_id_eq",header:"Partner",filterMatchMode:"contains",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:i(({filterModel:e,filterCallback:r})=>[n(_,{modelValue:e.value,"onUpdate:modelValue":[a=>e.value=a,r],suggestions:o.partners,onComplete:o.searchPartner,optionLabel:"name",optionValue:"id",class:"w-full capitalize",placeholder:"Filtra per partner"},{option:i(a=>[S("div",null,d(a.option.name),1)]),_:2},1032,["modelValue","onUpdate:modelValue","suggestions","onComplete"])]),body:i(({data:e})=>{var r;return[b(d((r=e==null?void 0:e.created_by)==null?void 0:r.partner_name),1)]}),_:1},512),n(s,{header:"",class:"text-center"},{header:i(()=>[pe]),body:i(({data:e})=>[S("i",{class:ae(["pi pi-circle-fill block text-center",{"text-red-600":e.semaforo=="R","text-yellow-50":e.semaforo=="G","text-green-300":e.semaforo=="V"}])},null,2)]),_:1}),n(s,{header:"Valutazione",ref:"valutazioni"},{body:i(({data:e})=>[b(d(e.valutazione),1)]),_:1},512),n(s,{header:"",style:{width:"4rem"}},{body:i(({data:e})=>[ne(n(v,{type:"button",onClick:r=>o.showSidebar(e),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-3",icon:"pi pi-arrow-right",text:"",rounded:""},null,8,["onClick"]),[[U,"Modifica",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","totalRecords","filters","loading"])])}const ve=R(re,[["render",fe]]),me={setup(){k(()=>{const s=le.now(),w=s.startOf("week").toFormat("dd"),_=s.endOf("week").toFormat("dd"),E=s.toFormat("MMMM yyyy");o.value=`${w}/${_} ${E}`});const f=se(),l=q(),p=L(),o=c(),F=M(()=>l.getTotalEvaluations),V=M(()=>f.isUserAdmin);return{totalEvaluation:F,weekDate:o,isAdmin:V,sidebarStore:p,showSidebar:function(){p.setDetailType("newEvaluationS",!0,"Nuova valutazione",null),p.updateSidebar(!0),p.setShowDetail(!0)}}},components:{EvaluationsSTable:ve}};function _e(f,l,p,o,F,V){const v=g("EvaluationsSTable");return T(),D("div",null,[n(v)])}const ge=R(me,[["render",_e]]);export{ge as default};
