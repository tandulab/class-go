import{o as B,X as O,z as K,Y as ae,t as oe,u as P,f as m,a as ne,q as c,b as le,g as se,Z as re,A as ie,_ as j,r as S,E as ue,h as g,i as T,k as _,x as v,M as L,W as N,j as r,w as s,l as M,G as R,J as ce,K as de,D as ve}from"../index41704.js";const fe={setup(){B(()=>{C.value=!0,u.value={first:0,page:0,rows:l.value.rows,sortField:null,sortOrder:null,filters:A.value},U(),ee(),te()});const f=O(),n=K(),h=ae(),a=oe(),w=P(),F=m(()=>f.responseEvaluations),d=m(()=>f.evaluationTypes),i=m(()=>h.allPartners),p=m(()=>a.allUsers),y=m(()=>w.isUserAdmin),k=m(()=>w.isUserMaster),z=t=>t.first_name+" "+t.last_name,e=ne(),l=c(),o=c(),V=c(),E=c(),{showLoader:I,hideLoader:D}=le(),A=c({cf:{value:"",matchMode:"eq"},piva:{value:"",matchMode:"eq"},created_at:{value:"",matchMode:"eq"},partner_id_eq:{value:"",matchMode:"eq"},created_by_id:{value:"",matchMode:"eq"}}),C=c(!0),u=c(),G=c(0),H=c([{label:"Attivo",value:"true"},{label:"Disattivo",value:"false"}]),W=c([{label:"Utente",value:"evaluation"},{label:"Admin",value:"admin"}]),Y=c([{label:"My Filter",value:"myfilter"}]),q=function(t){return t=ie(A,t),t.set("page",u.value.page+1),t.set("per_page",u.value.rows),u.value.sortField&&(u.value.sortOrder==1?t.set("sorted_by",u.value.sortField+"_asc"):t.set("sorted_by",u.value.sortField+"_desc")),t};function U(){C.value=!0;let t=new Map;q(t),setTimeout(()=>{J(t)},Math.random()*1e3+250)}const J=async function(t){await f.fetchAllEvaluations(t).then(()=>{C.value=!1}).catch(b=>{C.value=!1,se(e,b)})},X=t=>{u.value=t,U()},Z=t=>{u.value=t,U()},Q=()=>{u.value.page=0,u.value.filters=A.value,U()},$=function(t){n.setDetailType("evaluationS",!1,"Dettaglio valutazione",null,!1,!1,t),n.updateSidebar(!0)},ee=async function(){await h.fetchAllPartners()},te=async function(){let t=new Map;t.set("page",1),t.set("per_page",1e11),await a.fetchAllUsers(t)};return{dt:l,responseEvaluations:F,filters:A,loading:C,totalRecords:G,lazyParams:u,matchModes:Y,status:H,roles:W,currentEvaluation:o,evaluationTypes:d,partners:V,allPartner:i,allUsers:p,users:E,isAdmin:y,isMaster:k,onPage:X,onSort:Z,onFilter:Q,showSidebar:$,loadLazyData:U,searchPartner:t=>{const b=t.query.toLowerCase();V.value=i.value.filter(x=>x.name.toLowerCase().startsWith(b))},searchUser:t=>{const b=t.query.toLowerCase();E.value=p.value.filter(x=>(x.first_name.toLowerCase()+" "+x.last_name.toLowerCase()).includes(b)||x.email.toLowerCase().includes(b))},downloadReport:async function(){I();let t=new Map;q(t),await f.getEvaluationsReport(t).then(()=>{D()}).catch(()=>{D()})},showSidebarNewEvaluation:function(){n.setDetailType("newEvaluationS",!0,"Nuova valutazione",null),n.updateSidebar(!0),n.setShowDetail(!0)},createdByFullName:z,formatDataAndHourFromUnixTimestamps:re}},components:{}};const me={class:"flex justify-content-between align-items-center"},pe={class:""},_e={key:0},he={key:1},we=_("div",{class:"flex justify-content-center w-full"},"Semaforo",-1);function ye(f,n,h,a,w,F){const d=S("Button"),i=S("Column"),p=S("InputText"),y=S("AutoComplete"),k=S("DataTable"),z=ue("tooltip");return g(),T("div",null,[_("div",me,[_("h1",pe,[a.responseEvaluations.total==1?(g(),T("span",_e," 1 Valutazione")):(g(),T("span",he,v(a.responseEvaluations.total)+" Valutazioni",1))]),_("div",null,[a.isAdmin?(g(),L(d,{key:0,icon:"pi pi-download",class:"mb-3 mr-3",label:"Esporta report",rounded:"",outlined:"",onClick:n[0]||(n[0]=e=>a.downloadReport())})):N("",!0),a.isAdmin?N("",!0):(g(),L(d,{key:1,label:"Aggiungi valutazione",class:"mb-3",rounded:"",outlined:"",onClick:n[1]||(n[1]=e=>a.showSidebarNewEvaluation()),severity:"contrast"}))])]),r(k,{value:a.responseEvaluations.cqs_evaluations,totalRecords:a.responseEvaluations.total,lazy:!0,paginator:!0,rows:30,filters:a.filters,"onUpdate:filters":n[2]||(n[2]=e=>a.filters=e),ref:"dt",dataKey:"id",loading:a.loading,onPage:n[3]||(n[3]=e=>a.onPage(e)),onSort:n[4]||(n[4]=e=>a.onSort(e)),onFilter:n[5]||(n[5]=e=>a.onFilter()),filterDisplay:"row",removableSort:"",stripedRows:""},{empty:s(()=>[M(" Nessuna richiesta trovata. ")]),default:s(()=>[r(i,{header:"Data e ora",field:"created_at",ref:"created_at"},{body:s(({data:e})=>[M(v(a.formatDataAndHourFromUnixTimestamps(e==null?void 0:e.created_at)),1)]),_:1},512),r(i,{header:"Codice fiscale",ref:"cf",field:"cf",filterMatchMode:"contains",sortable:!0,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:s(({filterModel:e,filterCallback:l})=>[r(p,{type:"text",modelValue:e.value,"onUpdate:modelValue":o=>e.value=o,onKeydown:R(o=>l(),["enter"]),class:"p-column-filter",placeholder:"Filtra per codice fiscale"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),r(i,{header:"PIVA",ref:"piva",field:"piva",filterMatchMode:"contains",sortable:!0,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:s(({filterModel:e,filterCallback:l})=>[r(p,{type:"text",modelValue:e.value,"onUpdate:modelValue":o=>e.value=o,onKeydown:R(o=>l(),["enter"]),class:"p-column-filter",placeholder:"Filtra per partita iva"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),r(i,{field:"denominazione",header:"Denominazione",ref:"denominazione"},{body:s(({data:e})=>[M(v(e==null?void 0:e.denominazione),1)]),_:1},512),r(i,{field:"created_by_id",header:"Richiedente",filterMatchMode:"contains",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:s(({filterModel:e,filterCallback:l})=>[r(y,{modelValue:e.value,"onUpdate:modelValue":[o=>e.value=o,l],suggestions:a.users,onComplete:a.searchUser,optionLabel:a.createdByFullName,optionValue:"id",class:"w-full capitalize",placeholder:"Filtra per richiedente"},{option:s(o=>{var V,E;return[_("div",null,v((V=o==null?void 0:o.option)==null?void 0:V.first_name)+" "+v((E=o==null?void 0:o.option)==null?void 0:E.last_name),1)]}),_:2},1032,["modelValue","onUpdate:modelValue","suggestions","onComplete","optionLabel"])]),body:s(({data:e})=>{var l,o;return[M(v((l=e==null?void 0:e.created_by)==null?void 0:l.first_name)+" "+v((o=e==null?void 0:e.created_by)==null?void 0:o.last_name),1)]}),_:1}),r(i,{field:"partner_id_eq",ref:"partner_id_eq",header:"Partner",filterMatchMode:"contains",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:s(({filterModel:e,filterCallback:l})=>[r(y,{modelValue:e.value,"onUpdate:modelValue":[o=>e.value=o,l],suggestions:a.partners,onComplete:a.searchPartner,optionLabel:"name",optionValue:"id",class:"w-full capitalize",placeholder:"Filtra per partner"},{option:s(o=>[_("div",null,v(o.option.name),1)]),_:2},1032,["modelValue","onUpdate:modelValue","suggestions","onComplete"])]),body:s(({data:e})=>{var l;return[M(v((l=e==null?void 0:e.partner)==null?void 0:l.name),1)]}),_:1},512),r(i,{header:"",class:"text-center"},{header:s(()=>[we]),body:s(({data:e})=>[_("i",{class:ce(["pi pi-circle-fill block text-center",{"text-red-600":e.semaforo=="R","text-yellow-50":e.semaforo=="G","text-green-300":e.semaforo=="V"}])},null,2)]),_:1}),r(i,{header:"Valutazione",ref:"valutazioni"},{body:s(({data:e})=>[M(v(e.valutazione),1)]),_:1},512),r(i,{header:"",style:{width:"4rem"}},{body:s(({data:e})=>[de(r(d,{type:"button",onClick:l=>a.showSidebar(e),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-3",icon:"pi pi-arrow-right",text:"",rounded:""},null,8,["onClick"]),[[z,"Modifica",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","totalRecords","filters","loading"])])}const be=j(fe,[["render",ye]]),Me={setup(){B(()=>{const d=ve.now(),i=d.startOf("week").toFormat("dd"),p=d.endOf("week").toFormat("dd"),y=d.toFormat("MMMM yyyy");a.value=`${i}/${p} ${y}`});const f=P(),n=O(),h=K(),a=c(),w=m(()=>n.getTotalEvaluations),F=m(()=>f.isUserAdmin);return{totalEvaluation:w,weekDate:a,isAdmin:F,sidebarStore:h}},components:{EvaluationsSTable:be}};function Se(f,n,h,a,w,F){const d=S("EvaluationsSTable");return g(),T("div",null,[r(d)])}const Ue=j(Me,[["render",Se]]);export{Ue as default};
