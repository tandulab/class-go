import{o as D,q as U,s as T,u as x,c as M,a as B,p as r,_ as k,r as p,v as O,b as y,e as S,f as i,w as c,g as h,h as _,i as f,n as N,y as R,z as P,A as I}from"../index51180.js";import{u as z}from"./evaluation51180.js";import{e as L}from"./helpers51180.js";import{a as j}from"./formatData51180.js";import{D as H}from"./datetime51180.js";const $={setup(){D(()=>{u.value=!0,l.value={first:0,rows:v.value.rows,sortField:null,sortOrder:null,filters:s.value},U.register("myfilter",(a,F)=>a===F),w()});const m=z(),o=T(),d=x(),t=M(()=>m.responseEvaluations),b=M(()=>d.user),g=B(),v=r(),n=r(),s=r({global:{value:null,matchMode:"contains"},full_name:{value:"",matchMode:"contains"},email:{value:"",matchMode:"contains"},company_name:{value:"",matchMode:"contains"},created_at:{value:"",matchMode:"contains"},cf_piva:{value:"",matchMode:"contains"},ragioneSociale:{value:"",matchMode:"contains"}}),u=r(!0),l=r(),e=r(0),E=r([{label:"Attivo",value:"true"},{label:"Disattivo",value:"false"}]),A=r([{label:"Utente",value:"evaluation"},{label:"Admin",value:"admin"}]),C=r([{label:"My Filter",value:"myfilter"}]);function w(){u.value=!0;const a=new Map;a.set("piva",s.value.global.value),a.set("old_user_id",b.value.id),a.set("company_name",s.value.company_name.value),a.set("email",s.value.email.value),a.set("full_name",s.value.full_name.value),a.set("ragioneSociale",s.value.cf_piva.value),a.set("page",l.value.page+1),a.set("per_page",l.value.rows),l.value.sortField&&(l.value.sortOrder==1?a.set("sorted_by",l.value.sortField+"_asc"):a.set("sorted_by",l.value.sortField+"_desc")),setTimeout(()=>{V(a)},Math.random()*1e3+250)}const V=async function(a){await m.fetchAllEvaluations(a).then(()=>{u.value=!1}).catch(F=>{u.value=!1,L(g,F)})};return{dt:v,responseEvaluations:t,filters:s,loading:u,totalRecords:e,lazyParams:l,matchModes:C,status:E,roles:A,currentEvaluation:n,onPage:a=>{l.value=a,w()},onSort:a=>{l.value=a,w()},onFilter:()=>{l.value.page=0,l.value.filters=s.value,w()},showSidebar:function(a){o.setDetailType("evaluationS",!1,"Dettaglio valutazione",a.id,!1,!1),o.updateSidebar(!0)},loadLazyData:w,formatDataAndHourFromUnixTimestamps:j}},components:{}};const q={class:"flex justify-content-between align-items-center"},K={class:"p-input-icon-left w-full mr-3 py-2"},Y=h("i",{class:"pi pi-search"},null,-1);function G(m,o,d,t,b,g){const v=p("InputText"),n=p("Column"),s=p("Button"),u=p("DataTable"),l=O("tooltip");return y(),S("div",null,[i(u,{value:t.responseEvaluations.users,totalRecords:t.responseEvaluations.total,lazy:!0,paginator:!0,rows:30,filters:t.filters,"onUpdate:filters":o[1]||(o[1]=e=>t.filters=e),ref:"dt",dataKey:"id",loading:t.loading,onPage:o[2]||(o[2]=e=>t.onPage(e)),onSort:o[3]||(o[3]=e=>t.onSort(e)),onFilter:o[4]||(o[4]=e=>t.onFilter()),removableSort:"",stripedRows:""},{header:c(()=>[h("div",q,[h("span",K,[Y,i(v,{modelValue:t.filters.global.value,"onUpdate:modelValue":o[0]||(o[0]=e=>t.filters.global.value=e),placeholder:"Ricerca per partita iva",class:"border-none w-full",onChange:t.loadLazyData},null,8,["modelValue","onChange"])])])]),empty:c(()=>[_(" Nessuna richiesta trovata. ")]),default:c(()=>[i(n,{header:"Data e ora",field:"created_at",filterMatchMode:"contains",ref:"created_at",sortable:!0,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:c(({data:e})=>[_(f(t.formatDataAndHourFromUnixTimestamps(e==null?void 0:e.created_at)),1)]),_:1},512),i(n,{header:"P.Iva",filterMatchMode:"contains",ref:"cf_piva",field:"cf_piva",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},null,512),i(n,{field:"ragioneSociale",header:"Ragione Sociale",filterMatchMode:"contains",ref:"ragioneSociale",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:c(({data:e})=>[_(f(e.ragione_sociale&&e.ragione_sociale.length>30?e.ragione_sociale.substring(0,30)+"...":e.ragione_sociale),1)]),_:1},512),i(n,{field:"full_name",header:"Utente",filterMatchMode:"contains",ref:"full_name",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:c(({data:e})=>[_(f(e.first_name)+" "+f(e.last_name),1)]),_:1},512),i(n,{header:"Valutazione"},{body:c(({data:e})=>[h("i",{class:N(["pi pi-circle-fill mr-2",{"text-red-600":e.valutazioni=="Non solvibile","text-green-300":e.valutazioni=="Solvibile"}])},null,2),_(" "+f(e.valutazioni),1)]),_:1}),i(n,{header:"Report",filterMatchMode:"contains"},{body:c(({data:e})=>[_(f(e.pdf_url?e.pdf_approfondito_url?"2 allegati":"1 allegato":"0 allegati"),1)]),_:1}),i(n,{header:"",style:{width:"4rem"}},{body:c(({data:e})=>[R(i(s,{type:"button",onClick:E=>t.showSidebar(e),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-3",icon:"pi pi-arrow-right",text:"",rounded:""},null,8,["onClick"]),[[l,"Edit",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","totalRecords","filters","loading"])])}const J=k($,[["render",G]]),Q={setup(){D(()=>{const n=H.now(),s=n.startOf("week").toFormat("dd"),u=n.endOf("week").toFormat("dd"),l=n.toFormat("MMMM yyyy");t.value=`${s}/${u} ${l}`});const m=x(),o=z(),d=T(),t=r(),b=M(()=>o.getTotalEvaluations),g=M(()=>m.isUserAdmin);return{totalEvaluation:b,weekDate:t,isAdmin:g,sidebarStore:d,showSidebar:function(){d.setDetailType("newEvaluationS",!0,"Nuova valutazione",null),d.updateSidebar(!0),d.setShowDetail(!0)}}},components:{EvaluationsSTable:J}},W={class:"flex justify-content-between align-items-center"},X={class:""},Z={key:0},ee={key:1};function te(m,o,d,t,b,g){const v=p("Button"),n=p("EvaluationsSTable");return y(),S("div",null,[h("div",W,[h("h1",X,[t.totalEvaluation==1?(y(),S("span",Z," 1 Valutazione")):(y(),S("span",ee,f(t.totalEvaluation)+" Valutazioni",1))]),t.isAdmin?I("",!0):(y(),P(v,{key:0,label:"Aggiungi valutazione",class:"mb-3",rounded:"",outlined:"",onClick:o[0]||(o[0]=s=>t.showSidebar())}))]),i(n)])}const de=k(Q,[["render",te]]);export{de as default};
