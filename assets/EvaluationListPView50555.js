import{o as V,l as N,m as x,u as P,c as D,a as U,k as u,_ as k,r as w,n as B,b as i,e as m,f as l,w as d,g as r,h as n,t as b,x as R,q as O,v as I}from"../index50555.js";import{u as T}from"./evaluation50555.js";import{e as j,g as H,i as L,j as q}from"./helpers50555.js";const K={setup(){V(()=>{f.value=!0,e.value={first:0,rows:s.value.rows,sortField:null,sortOrder:null,filters:c.value},N.register("myfilter",(a,y)=>a===y),M()});const p=T(),o=x(),h=P(),t=D(()=>p.responseEvaluations),g=D(()=>h.user),E=D(()=>h.isUserAdmin),S=U(),s=u(),F=u(),c=u({global:{value:null,matchMode:"contains"},full_name:{value:"",matchMode:"contains"},email:{value:"",matchMode:"contains"},company_name:{value:"",matchMode:"contains"},created_at:{value:"",matchMode:"contains"},cf_piva:{value:"",matchMode:"contains"},ragioneSociale:{value:"",matchMode:"contains"}}),f=u(!0),e=u(),v=u(0),_=u([{label:"Attivo",value:"true"},{label:"Disattivo",value:"false"}]),C=u([{label:"Utente",value:"evaluation"},{label:"Admin",value:"admin"}]),A=u([{label:"My Filter",value:"myfilter"}]);function M(){f.value=!0;const a=new Map;a.set("with_children","1"),a.set("old_user_id",g.value.id),a.set("company_name",c.value.company_name.value),a.set("email",c.value.email.value),a.set("full_name",c.value.full_name.value),a.set("ragioneSociale",c.value.cf_piva.value),a.set("page",e.value.page+1),a.set("per_page",e.value.rows),e.value.sortField&&(e.value.sortOrder==1?a.set("sorted_by",e.value.sortField+"_asc"):a.set("sorted_by",e.value.sortField+"_desc")),setTimeout(()=>{z(a)},Math.random()*1e3+250)}const z=async function(a){await p.fetchAllEvaluationsP(a).then(()=>{f.value=!1}).catch(y=>{f.value=!1,j(S,y)})};return{dt:s,responseEvaluations:t,filters:c,loading:f,totalRecords:v,lazyParams:e,matchModes:A,status:_,roles:C,currentEvaluation:F,onPage:a=>{e.value=a,M()},onSort:a=>{e.value=a,M()},onFilter:()=>{e.value.page=0,e.value.filters=c.value,M()},showSidebar:function(a){let y=!0;E.value&&(y=!1),o.setDetailType("evaluationP",!1,"Dettaglio valutazione",a.id,y,!1),o.updateSidebar(!0)},loadLazyData:M,formatDataAndHourFromUnixTimestamps:H,formatPrettyDateHour:L,formatPrettyDate:q}},components:{}};const G={class:"flex justify-content-between align-items-center"},J={class:"p-input-icon-left w-full mr-3 py-2"},Q=r("i",{class:"pi pi-search"},null,-1),W={key:0},X=r("i",{class:"pi pi-circle-fill mr-2 text-green-300"},null,-1),Y={key:1},Z=r("i",{class:"pi pi-circle-fill mr-2 text-red-600"},null,-1),$={key:2},ee=r("i",{class:"pi pi-circle-fill mr-2 text-yellow-50"},null,-1),te={key:3},ae=r("i",{class:"pi pi-circle-fill mr-2 text-yellow-50"},null,-1),oe={key:4},se=r("i",{class:"pi pi-circle-fill mr-2 text-yellow-50"},null,-1);function le(p,o,h,t,g,E){const S=w("InputText"),s=w("Column"),F=w("Button"),c=w("DataTable"),f=B("tooltip");return i(),m("div",null,[l(c,{value:t.responseEvaluations.data,totalRecords:t.responseEvaluations.total,lazy:!0,paginator:!0,rows:30,filters:t.filters,"onUpdate:filters":o[1]||(o[1]=e=>t.filters=e),ref:"dt",dataKey:"id",loading:t.loading,onPage:o[2]||(o[2]=e=>t.onPage(e)),onSort:o[3]||(o[3]=e=>t.onSort(e)),onFilter:o[4]||(o[4]=e=>t.onFilter()),removableSort:"",stripedRows:""},{header:d(()=>[r("div",G,[r("span",J,[Q,l(S,{modelValue:t.filters.global.value,"onUpdate:modelValue":o[0]||(o[0]=e=>t.filters.global.value=e),placeholder:"Ricerca per partita iva",class:"border-none w-full",onChange:t.loadLazyData},null,8,["modelValue","onChange"])])])]),empty:d(()=>[n(" Nessuna richiesta trovata. ")]),default:d(()=>[l(s,{field:"first_name",header:"Nome consulente",filterMatchMode:"contains",ref:"first_name",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:d(({data:e})=>{var v,_;return[n(b((_=(v=e==null?void 0:e.creator)==null?void 0:v.profile)==null?void 0:_.name),1)]}),_:1},512),l(s,{field:"surname",header:"Cognome consulente",filterMatchMode:"contains",ref:"surname",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:d(({data:e})=>{var v,_;return[n(b((_=(v=e==null?void 0:e.creator)==null?void 0:v.profile)==null?void 0:_.surname),1)]}),_:1},512),l(s,{header:"Nome pensionato",filterMatchMode:"contains",ref:"name",field:"name",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},null,512),l(s,{header:"Cognome pensionato",field:"last_name"}),l(s,{header:"Data di nascita pensionato",field:"birthday",ref:"birthday"},{body:d(({data:e})=>[n(b(t.formatPrettyDate(e.birthday)),1)]),_:1},512),l(s,{header:"Data creazione",field:"created_at"},{body:d(({data:e})=>[n(b(t.formatPrettyDateHour(e==null?void 0:e.created_at)),1)]),_:1}),l(s,{header:"Valutazione"},{body:d(({data:e})=>[e.status==1?(i(),m("span",W,[X,n("Idoneo")])):e.status==2?(i(),m("span",Y,[Z,n(" Non Idoneo")])):e.status==4?(i(),m("span",$,[ee,n("Da pre-accettare")])):e.status==5?(i(),m("span",te,[ae,n("Valutazione in corso")])):(i(),m("span",oe,[se,n("Da compilare")])),n(" "+b(e.valutazioni),1)]),_:1}),l(s,{header:"",style:{width:"4rem"}},{body:d(({data:e})=>[R(l(F,{type:"button",onClick:v=>t.showSidebar(e),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-3",icon:"pi pi-arrow-right",text:"",rounded:""},null,8,["onClick"]),[[f,"Edit",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","totalRecords","filters","loading"])])}const ne=k(K,[["render",le]]),ie={setup(){const p=T(),o=x(),h=P(),t=D(()=>p.getTotalEvaluations),g=D(()=>h.isUserAdmin);return{totalEvaluation:t,isAdmin:g,showSidebar:function(){o.setDetailType("newEvaluationP",!0,"Nuova valutazione",null),o.updateSidebar(!0),o.setShowDetail(!0)}}},components:{EvaluationsPTable:ne}},re={class:"flex justify-content-between align-items-center"},ce={class:""},ue={key:0},de={key:1};function me(p,o,h,t,g,E){const S=w("Button"),s=w("EvaluationsPTable");return i(),m("div",null,[r("div",re,[r("h1",ce,[t.totalEvaluation==1?(i(),m("span",ue," 1 Richiesta pensione")):(i(),m("span",de,b(t.totalEvaluation)+" Richieste pensioni",1))]),t.isAdmin?I("",!0):(i(),O(S,{key:0,label:"Aggiungi valutazione",class:"mb-3",rounded:"",outlined:"",onClick:o[0]||(o[0]=F=>t.showSidebar())}))]),l(s)])}const we=k(ie,[["render",me]]);export{we as default};
